# KIS_CORE_V2 Auto-Fix Brief
Generated: 2025-09-19 00:04:29

## Issues Requiring Fixes

### 1. MEDIUM RISK: Duplicate/Orphan File
**File**: `engine/engine_util_io.py`
**Issue**: Duplicate of `_util_io.py`, creates confusion
**Fix**: Delete the file
```bash
rm engine/engine_util_io.py
```

### 2. HIGH RISK: Non-functional Excel Templates
**Files**: `KIS/Templates/Cover.xlsx`, `KIS/Templates/Estimate.xlsx`
**Issue**: 2-byte stub files, cannot be used
**Fix**: Generate minimal valid Excel files
```python
# Generate minimal Cover.xlsx
import openpyxl
wb = openpyxl.Workbook()
ws = wb.active
ws.title = "Cover"
ws['B3'] = "Project Name"
ws['B4'] = "Client Name"
ws['H52'] = 0
wb.save('KIS/Templates/Cover.xlsx')

# Generate minimal Estimate.xlsx
wb = openpyxl.Workbook()
ws = wb.active
ws.title = "Estimate"
ws['A10'] = "Item"
ws['H52'] = 0  # Net
ws['H53'] = 0  # VAT
ws['H54'] = 0  # Total
wb.save('KIS/Templates/Estimate.xlsx')
```

### 3. LOW RISK: Missing SVG Generation
**Files**: `engine/estimate_formatter.py`, `engine/cover_tab_writer.py`
**Issue**: No SVG visualization generated
**Fix**: Add SVG generation function

<<<PATCH_BUNDLE_START>>>
# File: engine/estimate_formatter.py
# Add after line 297 (after make_evidence call)
def _generate_estimate_svg(result: Dict) -> str:
    """Generate SVG visualization of estimate summary."""
    svg_parts = [
        '<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300">',
        '<rect width="100%" height="100%" fill="#f0f9ff"/>',
        '<text x="200" y="30" text-anchor="middle" font-size="18" font-weight="bold">Estimate Summary</text>',
        f'<text x="50" y="80" font-size="14">Named Ranges: {result["named_ranges"]["applied"]}/{result["named_ranges"]["total"]}</text>',
        f'<text x="50" y="110" font-size="14">Validation: {"PASS" if result["validation_pass"] else "FAIL"}</text>',
        f'<text x="50" y="140" font-size="14">Lint Errors: {result["format_lint"]["errors"]}</text>',
        '</svg>'
    ]
    return '\n'.join(svg_parts)

# In main() function, after make_evidence:
svg_content = _generate_estimate_svg(result)
svg_path = out.with_suffix('.svg')
write_text(svg_path, svg_content)

# File: engine/cover_tab_writer.py
# Add similar SVG generation after make_evidence call
def _generate_cover_svg(result: Dict) -> str:
    """Generate SVG visualization of cover sheet."""
    svg_parts = [
        '<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300">',
        '<rect width="100%" height="100%" fill="#f0f9ff"/>',
        '<text x="200" y="30" text-anchor="middle" font-size="18" font-weight="bold">Cover Sheet</text>',
        f'<text x="50" y="80" font-size="14">Compliance: {"PASS" if result.get("compliance", {}).get("pass") else "FAIL"}</text>',
        '</svg>'
    ]
    return '\n'.join(svg_parts)
<<<PATCH_BUNDLE_END>>>

### 4. LOW RISK: Temporary Files Cleanup
**Issue**: Python cache files exist
**Fix**: Clean cache
```bash
find . -type d -name "__pycache__" -exec rm -rf {} +
find . -name "*.pyc" -o -name "*.pyo" -exec rm {} +
```

## Risk Assessment

| Issue | Risk | Impact | Effort | Priority |
|-------|------|--------|--------|----------|
| Stub Excel files | HIGH | Templates unusable | Medium | 1 |
| Duplicate util file | MEDIUM | Confusion | Low | 2 |
| Missing SVG | LOW | Incomplete evidence | Low | 3 |
| Cache files | LOW | Clutter | Low | 4 |

## Implementation Order

1. **Immediate**: Delete `engine/engine_util_io.py`
2. **Urgent**: Create valid Excel templates or obtain real templates
3. **Nice-to-have**: Add SVG generation to 2 engines
4. **Cleanup**: Remove cache files

## Validation After Fixes

```bash
# Verify fixes
ls -la engine/engine_util_io.py 2>/dev/null || echo "✓ Duplicate removed"
python -c "import openpyxl; openpyxl.load_workbook('KIS/Templates/Cover.xlsx')" && echo "✓ Cover.xlsx valid"
python -c "import openpyxl; openpyxl.load_workbook('KIS/Templates/Estimate.xlsx')" && echo "✓ Estimate.xlsx valid"
find . -name "__pycache__" | wc -l  # Should be 0
```

## Notes

- All fixes preserve function signatures and CLI interfaces
- No changes to core business logic
- Foundation-Only mode maintained
- No network or deployment code added