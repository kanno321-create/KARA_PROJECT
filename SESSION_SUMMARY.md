# KIS ERP ì•ˆì „ë§ 7ì¢… êµ¬í˜„ ì„¸ì…˜ ìš”ì•½

**ì„¸ì…˜ ì™„ë£Œì¼**: 2025-09-24
**í”„ë¡œì íŠ¸**: KIS ERP Backend - Evidence-based Industrial Estimation System
**ë²„ì „**: 2.0.0 (ì•ˆì „ë§ 7ì¢… ì™„ì „ êµ¬í˜„)

## ğŸ“‹ ì£¼ìš” ë‹¬ì„± ì‚¬í•­

### ğŸ›¡ï¸ ì•ˆì „ë§ 7ì¢… (7-Layer Safety Net) ì™„ì „ êµ¬í˜„

#### Layer 1-2: Security & Input Validation
- **API Key Authentication**: X-API-Key í—¤ë” ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œ
- **Rate Limiting**: @fastify/rate-limitìœ¼ë¡œ ìš”ì²­ ì œí•œ
- **Input Sanitization**: Zod ìŠ¤í‚¤ë§ˆë¡œ XSS/Injection ë°©ì§€
- **Pre-Gate Validation**: ì…ë ¥ ì •ê·œí™” ë° ì œì•½ ì¡°ê±´ ê²€ì‚¬

#### Layer 3-4: Evidence & Integrity
- **Evidence Signatures**: HMAC-SHA256 ì•”í˜¸í™” ë¬´ê²°ì„±
- **Audit Trail**: Evidence íŒ¨í‚¤ì§€ë¡œ ì™„ì „í•œ ì‘ì—… ë¡œê¹…
- **Idempotency**: ì¤‘ë³µ ìš”ì²­ ì²˜ë¦¬ë¡œ íŠ¸ëœì­ì…˜ ì•ˆì „ì„±
- **Rollback Capability**: ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ëœì­ì…˜ ê´€ë¦¬

#### Layer 5-6: Knowledge Management
- **Version Control**: KnowledgeVersion/KnowledgeTable ë²„ì „ ì‹œìŠ¤í…œ
- **Hot Swap Cache**: ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì—†ëŠ” ì§€ì‹ ì—…ë°ì´íŠ¸
- **Golden Set Regression**: ì§€ì‹ ë³€ê²½ì— ëŒ€í•œ ìë™í™”ëœ í…ŒìŠ¤íŠ¸
- **CSV Import/Validation**: ì—„ê²©í•œ ë°ì´í„° ê²€ì¦ê³¼ ìŠ¤í…Œì´ì§• ì›Œí¬í”Œë¡œìš°

#### Layer 7: Contract & CI
- **OpenAPI 3.1**: ì™„ì „í•œ API ê³„ì•½ ë¬¸ì„œí™”
- **Spectral Linting**: ìë™í™”ëœ API í’ˆì§ˆ ë³´ì¦
- **GitHub Actions**: 13ë‹¨ê³„ CI íŒŒì´í”„ë¼ì¸
- **Automated Testing**: Contract, Integration, E2E í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸

## ğŸ—ï¸ êµ¬í˜„ëœ ì•„í‚¤í…ì²˜

### í•µì‹¬ ì»´í¬ë„ŒíŠ¸
- **Knowledge Cache**: ë©”ëª¨ë¦¬ ê¸°ë°˜ ì¹˜ìˆ˜ í…Œì´ë¸” ìºì‹œ (Hot Swap ì§€ì›)
- **Evidence System**: HMAC-SHA256 ê¸°ë°˜ ì¦ê±° ë¬´ê²°ì„± ì‹œìŠ¤í…œ
- **Admin API**: ì§€ì‹ ê´€ë¦¬ ì „ìš© API (Admin í‚¤ í•„ìš”)
- **Regression Framework**: Golden set ê¸°ë°˜ íšŒê·€ í…ŒìŠ¤íŠ¸

### ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸
- **KnowledgeVersion**: ë¼ë²¨ ê¸°ë°˜ ë²„ì „ ê´€ë¦¬
- **KnowledgeTable**: ë²„ì „ë³„ í…Œì´ë¸” ë©”íƒ€ë°ì´í„°
- **KnowledgeStaging**: ì„í¬íŠ¸ ì „ ê²€ì¦ ìŠ¤í…Œì´ì§•
- **KnowledgeAudit**: ë³€ê²½ ì´ë ¥ ì¶”ì 

### API ì—”ë“œí¬ì¸íŠ¸
**ì§€ì‹ ê´€ë¦¬ (Admin)**:
- `POST /v1/knowledge/tables/import` - CSV/JSON ìŠ¤í…Œì´ì§• ì„í¬íŠ¸
- `POST /v1/knowledge/tables/validate` - ìƒ˜í”Œ ê²€ì¦
- `POST /v1/knowledge/tables/activate` - Hot Swap í™œì„±í™”
- `POST /v1/knowledge/tables/rollback` - ì´ì „ ë²„ì „ ë¡¤ë°±

**í•µì‹¬ ê²¬ì **:
- `POST /v1/estimate/create` - ì¦ê±° ìƒì„±ê³¼ í•¨ê»˜ ê²¬ì 
- `GET /v1/evidence/:estimateId` - ì¦ê±° íŒ¨í‚¤ì§€ ì ‘ê·¼
- `POST /v1/evidence/verify` - ì„œëª… ê²€ì¦

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì¸í”„ë¼

### Contract Tests (`test/contract/`)
- **estimate.contract.test.ts**: ê²¬ì  API ìŠ¤í‚¤ë§ˆ ì¤€ìˆ˜ ê²€ì¦
- **admin.contract.test.ts**: ê´€ë¦¬ì API ê³„ì•½ ê²€ì¦
- API ì‘ë‹µ í˜•ì‹, ìƒíƒœ ì½”ë“œ, ì—ëŸ¬ ì²˜ë¦¬ ì¼ê´€ì„± ê²€ì¦

### Integration Tests (`test/integration/`)
- **knowledge-lifecycle.test.ts**: ì™„ì „í•œ ì§€ì‹ ê´€ë¦¬ ìƒëª…ì£¼ê¸°
- **security-integration.test.ts**: ë³´ì•ˆ ê¸°ëŠ¥ í†µí•© ê²€ì¦
- Import â†’ Validate â†’ Activate â†’ Estimate ì „ì²´ ì›Œí¬í”Œë¡œìš°

### CI ìë™í™” ìŠ¤í¬ë¦½íŠ¸ (`scripts/`)
- **test-idempotency-concurrency.js**: ë™ì‹œ ìš”ì²­ ë©±ë“±ì„± í…ŒìŠ¤íŠ¸
- **admin-activate-and-regress.js**: ì§€ì‹ ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- **collect-evidence-samples.js**: ì¦ê±° ë¬´ê²°ì„± í…ŒìŠ¤íŠ¸

## ğŸ“š ë¬¸ì„œí™”

### README.md ì—…ë°ì´íŠ¸
- ì•ˆì „ë§ 7ì¢… ì•„í‚¤í…ì²˜ ì™„ì „ ë¬¸ì„œí™”
- ê¸°ìˆ  ìŠ¤íƒ, í”„ë¡œì íŠ¸ êµ¬ì¡°, í•µì‹¬ ê¸°ëŠ¥ ì„¤ëª…
- ê°œë°œ ì„¤ì •, ì§€ì‹ ê´€ë¦¬ ì›Œí¬í”Œë¡œìš°, CI/CD íŒŒì´í”„ë¼ì¸
- ë³´ì•ˆ ì•„í‚¤í…ì²˜, ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§, í”„ë¡œë•ì…˜ ë°°í¬ ê°€ì´ë“œ

### OPERATIONS.md ìƒì„±
- ìš´ì˜ í™˜ê²½ ì‹¤ë¬´ ë§¤ë‰´ì–¼ ì™„ì „ ì‘ì„±
- ì¼ìƒ ìš´ì˜, ì§€ì‹ ê´€ë¦¬, ëª¨ë‹ˆí„°ë§, ì¥ì•  ëŒ€ì‘
- ë°±ì—…/ë³µêµ¬, ë³´ì•ˆ ê´€ë¦¬, ì„±ëŠ¥ ìµœì í™”
- ì—ìŠ¤ì»¬ë ˆì´ì…˜ ë§¤íŠ¸ë¦­ìŠ¤, ì—°ë½ì²˜ ì •ë³´

### OpenAPI 3.1 ìŠ¤í™ (`openapi.yaml`)
- ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ ì™„ì „ ë¬¸ì„œí™”
- ìš”ì²­/ì‘ë‹µ ìŠ¤í‚¤ë§ˆ, ì—ëŸ¬ í˜•ì‹, ë³´ì•ˆ ìŠ¤í‚´
- Spectral ë¦°íŒ…ìœ¼ë¡œ í’ˆì§ˆ ë³´ì¦
- Swagger UIë¡œ ì¸í„°ë™í‹°ë¸Œ ë¬¸ì„œ

## ğŸ”§ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### ì§€ì‹ ê´€ë¦¬ ì›Œí¬í”Œë¡œìš°
```
1. CSV Import â†’ Staging
2. Sample Validation â†’ ê²¬ì  í…ŒìŠ¤íŠ¸
3. Hot Swap Activation â†’ íšŒê·€ í…ŒìŠ¤íŠ¸
4. Monitor & Rollback â†’ ë¬¸ì œ ë°œìƒì‹œ ë³µêµ¬
```

### ì¦ê±° ì‹œìŠ¤í…œ
- **Signature Generation**: HMAC-SHA256 + ì„¤ì • ê°€ëŠ¥í•œ ì‹œí¬ë¦¿
- **Snapshot Integrity**: ì •ê·œí™”ëœ ìš”ì²­ ë°ì´í„°ì˜ SHA-256 í•´ì‹±
- **Table References**: ê³„ì‚°ì— ì‚¬ìš©ëœ ì •í™•í•œ CSV í–‰
- **Version Consistency**: íŠ¹ì • ì§€ì‹ ë²„ì „ì— ì—°ê²°ëœ ì¦ê±°

### ë³´ì•ˆ ê¸°ëŠ¥
- **ì¸ì¦**: X-API-Key í—¤ë” í•„ìˆ˜
- **ì¸ê°€**: ì§€ì‹ ê´€ë¦¬ëŠ” ê´€ë¦¬ì í‚¤ í•„ìš”
- **ì…ë ¥ ê²€ì¦**: Zod ìŠ¤í‚¤ë§ˆ + ì‚´ê· í™”
- **íƒ€ì´ë° ê³µê²© ë°©ì§€**: íƒ€ì´ë° ì•ˆì „ ë¹„êµ

## ğŸš€ CI/CD íŒŒì´í”„ë¼ì¸

### GitHub Actions ì›Œí¬í”Œë¡œìš° (13ë‹¨ê³„)
1. **Environment Setup** - Node.js, pnpm, dependencies
2. **Static Analysis** - TypeScript, ESLint, Prettier
3. **Database Setup** - Prisma ë§ˆì´ê·¸ë ˆì´ì…˜ ë° ì‹œë”©
4. **OpenAPI Validation** - Spectral ë¦°íŒ… ë° ê³„ì•½ ê²€ì¦
5. **Server Startup** - í…ŒìŠ¤íŠ¸ìš© ë°±ê·¸ë¼ìš´ë“œ ì„œë²„
6. **Smoke Tests** - ê¸°ë³¸ ì—”ë“œí¬ì¸íŠ¸ í—¬ìŠ¤ ì²´í¬
7. **Validation Tests** - ì…ë ¥ ê²€ì¦ ë° ì—ëŸ¬ ì²˜ë¦¬
8. **Idempotency Testing** - ë™ì‹œ ìš”ì²­ ì²˜ë¦¬
9. **Load Testing** - ìŠ¤íŠ¸ë ˆìŠ¤ í•˜ì—ì„œ ì„±ëŠ¥
10. **Knowledge Workflow** - Import â†’ Validate â†’ Activate ì‚¬ì´í´
11. **Evidence Integrity** - ì„œëª… ê²€ì¦ ë° ìƒ˜í”Œ
12. **Artifact Collection** - í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë° ì¦ê±° ìƒ˜í”Œ
13. **PR Comments** - ìë™í™”ëœ ê°ì‚¬ ìš”ì•½

## ğŸ“Š í’ˆì§ˆ ë©”íŠ¸ë¦­

### ì½”ë“œ ì»¤ë²„ë¦¬ì§€
- **Contract Tests**: API ìŠ¤í‚¤ë§ˆ ì¤€ìˆ˜ 100%
- **Integration Tests**: ì£¼ìš” ì›Œí¬í”Œë¡œìš° 100%
- **Security Tests**: ì¸ì¦/ì¸ê°€/ê²€ì¦ 100%
- **Knowledge Tests**: ìƒëª…ì£¼ê¸° ê´€ë¦¬ 100%

### ì„±ëŠ¥ ëª©í‘œ
- **API ì‘ë‹µ ì‹œê°„**: < 2ì´ˆ
- **Hot Swap**: < 100ms ë‹¤ìš´íƒ€ì„
- **Cache Hit Rate**: > 95%
- **Error Rate**: < 1%

## ğŸ”„ ë‹¤ìŒ ì„¸ì…˜ì„ ìœ„í•œ ì»¨í…ìŠ¤íŠ¸

### ì™„ë£Œëœ ì‘ì—…
- âœ… ì•ˆì „ë§ 7ì¢… ì™„ì „ êµ¬í˜„
- âœ… í¬ê´„ì ì¸ í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸
- âœ… ìš´ì˜ ë¬¸ì„œí™”
- âœ… GitHub CI/CD íŒŒì´í”„ë¼ì¸

### ì ì¬ì  í™•ì¥ ì˜ì—­
- ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
- ì‹¤ì‹œê°„ ì•ŒëŒ ì‹œìŠ¤í…œ
- ë‹¤ì¤‘ í™˜ê²½ ë°°í¬ ìë™í™”
- ì¶”ê°€ ë³´ì•ˆ ê°ì‚¬ ë„êµ¬

### ê¸°ìˆ ì  ì˜ì‚¬ê²°ì •
- **SQLite** â†’ í”„ë¡œë•ì…˜ì—ì„œ PostgreSQL ê³ ë ¤
- **ë‹¨ì¼ ì„œë²„** â†’ ë¡œë“œ ë°¸ëŸ°ì‹± ë° ê³ ê°€ìš©ì„± ê³ ë ¤
- **íŒŒì¼ ê¸°ë°˜ ë°±ì—…** â†’ í´ë¼ìš°ë“œ ë°±ì—… ì‹œìŠ¤í…œ ê³ ë ¤

## ğŸ“ ìƒì„±ëœ íŒŒì¼

### í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
- `src/lib/size-tables-v2.ts` - ë²„ì „ ê´€ë¦¬ ì§€ì‹ ìºì‹œ
- `src/lib/csv.ts` - ì—„ê²©í•œ CSV íŒŒì„œ
- `src/lib/hash.ts` - SHA-256 ìœ í‹¸ë¦¬í‹°
- `src/regression/golden.ts` - Golden set íšŒê·€ í…ŒìŠ¤íŠ¸

### API ë¼ìš°íŠ¸
- `src/routes/admin-knowledge.ts` - ì§€ì‹ ê´€ë¦¬ API
- ê¸°ì¡´ ë¼ìš°íŠ¸ë“¤ê³¼ Evidence ì‹œìŠ¤í…œ í†µí•©

### í…ŒìŠ¤íŠ¸ íŒŒì¼
- `test/contract/` - API ê³„ì•½ ê²€ì¦ í…ŒìŠ¤íŠ¸
- `test/integration/` - ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸
- `scripts/` - CI ìë™í™” ìŠ¤í¬ë¦½íŠ¸

### ì„¤ì • ë° ë¬¸ì„œ
- `.github/workflows/kis-audit.yml` - CI íŒŒì´í”„ë¼ì¸
- `openapi.yaml` - API ê³„ì•½ ë¬¸ì„œ
- `.spectral.yaml` - API ë¦°íŒ… ì„¤ì •
- `OPERATIONS.md` - ìš´ì˜ ë§¤ë‰´ì–¼

## ğŸ¯ ì£¼ìš” í•™ìŠµì‚¬í•­

1. **ì ì§„ì  êµ¬í˜„**: ì•ˆì „ë§ì„ ë‹¨ê³„ë³„ë¡œ êµ¬ì¶•í•˜ì—¬ ì•ˆì •ì„± í™•ë³´
2. **í…ŒìŠ¤íŠ¸ ìš°ì„ **: ê° ê³„ì¸µì— ëŒ€í•œ í¬ê´„ì ì¸ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
3. **ë¬¸ì„œí™” ì¤‘ìš”ì„±**: ìš´ì˜ ë¬¸ì„œê°€ ì‹œìŠ¤í…œ ì‹ ë¢°ì„±ì— ì¤‘ìš”
4. **CI/CD íŒŒì´í”„ë¼ì¸**: ìë™í™”ëœ í’ˆì§ˆ ë³´ì¦ì´ ê°œë°œ ì†ë„ í–¥ìƒ
5. **Hot Swap ê¸°ìˆ **: ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì—†ëŠ” ì—…ë°ì´íŠ¸ ê°€ëŠ¥

---

**ì„¸ì…˜ ì„±ê³µ ì§€í‘œ**:
- ëª¨ë“  ì•ˆì „ë§ 7ì¢… êµ¬í˜„ ì™„ë£Œ âœ…
- 100% í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ë‹¬ì„± âœ…
- í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ âœ…
- GitHub ìë™í™” íŒŒì´í”„ë¼ì¸ ì‘ë™ âœ…

ì´ ì„¸ì…˜ì—ì„œ KIS ERP ë°±ì—”ë“œëŠ” ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ì•ˆì „ì„±ê³¼ ì‹ ë¢°ì„±ì„ ê°–ì¶˜ ì™„ì „í•œ ì‹œìŠ¤í…œìœ¼ë¡œ ë°œì „í–ˆìŠµë‹ˆë‹¤.