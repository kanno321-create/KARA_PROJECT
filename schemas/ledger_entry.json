{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://kis-core.com/schemas/ledger_entry.json",
  "title": "ERP Ledger Entry Schema",
  "description": "Complete accounting ledger entry schema for Korean business context",
  "type": "object",
  "properties": {
    "entry_id": {
      "type": "string",
      "pattern": "^LED-[0-9]{8}-[A-Z0-9]{6}$",
      "description": "Unique ledger entry identifier"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$"
    },
    "posting_date": {
      "type": "string",
      "format": "date",
      "description": "Date when transaction was posted"
    },
    "transaction_date": {
      "type": "string",
      "format": "date",
      "description": "Date when transaction occurred"
    },
    "fiscal_period": {
      "type": "object",
      "properties": {
        "year": {
          "type": "integer",
          "minimum": 2000,
          "maximum": 2100
        },
        "period": {
          "type": "integer",
          "minimum": 1,
          "maximum": 12
        }
      },
      "required": ["year", "period"]
    },
    "account": {
      "type": "object",
      "properties": {
        "account_code": {
          "type": "string",
          "pattern": "^[0-9]{4,8}$",
          "description": "Korean standard chart of accounts code"
        },
        "account_name": {
          "type": "string",
          "minLength": 1
        },
        "account_type": {
          "type": "string",
          "enum": ["assets", "liabilities", "equity", "revenue", "expenses"]
        },
        "account_class": {
          "type": "string",
          "description": "Korean accounting classification (자산, 부채, 자본, 수익, 비용)"
        }
      },
      "required": ["account_code", "account_name", "account_type"]
    },
    "debit": {
      "type": "number",
      "minimum": 0,
      "description": "Debit amount in KRW"
    },
    "credit": {
      "type": "number",
      "minimum": 0,
      "description": "Credit amount in KRW"
    },
    "currency": {
      "type": "object",
      "properties": {
        "code": {
          "type": "string",
          "pattern": "^[A-Z]{3}$",
          "default": "KRW"
        },
        "exchange_rate": {
          "type": "number",
          "minimum": 0,
          "description": "Exchange rate to KRW if foreign currency"
        },
        "original_amount": {
          "type": "number",
          "description": "Original amount in foreign currency"
        }
      },
      "required": ["code"]
    },
    "doc_ref": {
      "type": "object",
      "description": "Document reference information",
      "properties": {
        "document_type": {
          "type": "string",
          "enum": ["invoice", "receipt", "voucher", "journal", "payment", "estimate", "contract"]
        },
        "document_number": {
          "type": "string",
          "minLength": 1
        },
        "document_date": {
          "type": "string",
          "format": "date"
        },
        "attachment_path": {
          "type": "string",
          "description": "Path to supporting document evidence"
        }
      },
      "required": ["document_type", "document_number"]
    },
    "tax_code": {
      "type": "object",
      "description": "Korean tax code information",
      "properties": {
        "vat_code": {
          "type": "string",
          "enum": ["10", "0", "EXEMPT", "ZERO_RATED"],
          "description": "Korean VAT code (10%, 0%, 면세, 영세율)"
        },
        "vat_amount": {
          "type": "number",
          "minimum": 0
        },
        "withholding_tax": {
          "type": "object",
          "properties": {
            "rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "amount": {
              "type": "number",
              "minimum": 0
            },
            "type": {
              "type": "string",
              "enum": ["income", "corporate", "local_income", "special"]
            }
          }
        },
        "business_type_code": {
          "type": "string",
          "description": "Korean business type code for tax reporting"
        }
      }
    },
    "counterparty": {
      "type": "object",
      "description": "Business partner information",
      "properties": {
        "business_number": {
          "type": "string",
          "pattern": "^[0-9]{3}-[0-9]{2}-[0-9]{5}$",
          "description": "Korean business registration number"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "type": "string",
          "enum": ["customer", "supplier", "employee", "government", "bank", "other"]
        },
        "representative": {
          "type": "string",
          "description": "Legal representative name"
        },
        "address": {
          "type": "string"
        },
        "contact": {
          "type": "object",
          "properties": {
            "email": {
              "type": "string",
              "format": "email"
            },
            "phone": {
              "type": "string"
            }
          }
        }
      },
      "required": ["name", "type"]
    },
    "description": {
      "type": "string",
      "minLength": 1,
      "description": "Transaction description"
    },
    "cost_center": {
      "type": "object",
      "properties": {
        "code": {
          "type": "string",
          "pattern": "^CC[0-9]{4}$"
        },
        "name": {
          "type": "string"
        },
        "department": {
          "type": "string"
        }
      }
    },
    "project_code": {
      "type": "string",
      "pattern": "^[A-Z0-9]{3,10}$",
      "description": "Project identifier for project accounting"
    },
    "reconciliation": {
      "type": "object",
      "properties": {
        "bank_statement_ref": {
          "type": "string"
        },
        "reconciled_date": {
          "type": "string",
          "format": "date"
        },
        "reconciled_by": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": ["pending", "reconciled", "disputed", "void"]
        }
      }
    },
    "approval": {
      "type": "object",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["draft", "pending", "approved", "rejected"]
        },
        "approved_by": {
          "type": "string"
        },
        "approved_date": {
          "type": "string",
          "format": "date-time"
        },
        "approval_level": {
          "type": "integer",
          "minimum": 1,
          "maximum": 5
        }
      },
      "required": ["status"]
    },
    "hash": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256 hash for data integrity verification"
    },
    "evidence": {
      "type": "object",
      "properties": {
        "source_system": {
          "type": "string",
          "description": "Source ERP system identifier"
        },
        "extraction_timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "evidence_files": {
          "type": "array",
          "items": {
            "type": "string",
            "description": "Paths to PNG/SVG/CSV/JSON evidence files"
          }
        },
        "data_quality_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      },
      "required": ["source_system", "extraction_timestamp"]
    },
    "audit_trail": {
      "type": "object",
      "properties": {
        "created_by": {
          "type": "string"
        },
        "created_timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "last_modified_by": {
          "type": "string"
        },
        "last_modified_timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "work_id": {
          "type": "string"
        },
        "input_hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        },
        "output_hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        }
      },
      "required": ["created_by", "created_timestamp", "work_id"]
    }
  },
  "required": [
    "entry_id",
    "version", 
    "posting_date",
    "transaction_date",
    "fiscal_period",
    "account",
    "description",
    "doc_ref",
    "hash",
    "evidence",
    "audit_trail"
  ],
  "oneOf": [
    {"properties": {"debit": {"minimum": 0.01}}, "required": ["debit"]},
    {"properties": {"credit": {"minimum": 0.01}}, "required": ["credit"]}
  ]
}