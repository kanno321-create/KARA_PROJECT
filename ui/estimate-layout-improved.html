<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIS CORE - ê²¬ì  ì‹œìŠ¤í…œ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', 'Noto Sans KR', sans-serif;
            background-color: #f5f5f5;
            color: #323130;
            font-size: 14px;
        }

        .app-container {
            display: flex;
            height: 100vh;
            background: white;
        }

        /* ì¢Œì¸¡ ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 250px;
            background: #f9f9f9;
            border-right: 1px solid #e1dfdd;
            display: flex;
            flex-direction: column;
        }

        .logo {
            padding: 20px;
            border-bottom: 1px solid #e1dfdd;
            font-size: 18px;
            font-weight: 600;
            color: #0078d4;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            cursor: pointer;
            color: #605e5c;
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .menu-item:hover {
            background: #f3f2f1;
            color: #323130;
        }

        .menu-item.active {
            background: #0078d4;
            color: white;
        }

        .menu-icon {
            margin-right: 10px;
            font-size: 16px;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* íƒ­ ì˜ì—­ */
        .tab-container {
            background: white;
            border-bottom: 1px solid #e1dfdd;
            display: flex;
            align-items: center;
            padding: 0 20px;
        }

        .tab {
            padding: 10px 16px;
            border: 1px solid #d1d1d1;
            border-bottom: none;
            background: #f9f9f9;
            cursor: pointer;
            margin-right: 2px;
            display: flex;
            align-items: center;
            border-radius: 4px 4px 0 0;
        }

        .tab.active {
            background: white;
            border-color: #0078d4;
            color: #0078d4;
        }

        .tab-close {
            margin-left: 8px;
            cursor: pointer;
            color: #999;
        }

        .tab-close:hover {
            color: #666;
        }

        .new-tab {
            padding: 8px 12px;
            background: #0078d4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        /* ì»¨í…ì¸  ì˜ì—­ - ì¢Œì¸¡ ë” ë„“ê²Œ */
        .content-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .left-panel {
            width: 500px; /* 400pxì—ì„œ 500pxë¡œ í™•ëŒ€ */
            padding: 20px;
            overflow-y: auto;
            background: white;
            border-right: 1px solid #e1dfdd;
        }

        .right-panel {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: white;
            position: relative;
        }

        /* ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .section {
            margin-bottom: 20px;
            border: 1px solid #e1dfdd;
            border-radius: 4px;
            background: white;
        }

        .section-header {
            background: #f9f9f9;
            padding: 12px 16px;
            border-bottom: 1px solid #e1dfdd;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-content {
            padding: 16px;
        }

        /* í¼ ìš”ì†Œë“¤ */
        .form-row {
            display: flex;
            flex-direction: column;
            margin-bottom: 12px;
        }

        .form-row-horizontal {
            display: flex;
            gap: 12px;
            align-items: end;
            margin-bottom: 12px;
        }

        /* 2x2 ê·¸ë¦¬ë“œ */
        .grid-2x2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        /* 1x5 ê·¸ë¦¬ë“œ (ë©”ì¸ì°¨ë‹¨ê¸°) - í¬ê¸° ì¡°ì • */
        .grid-1x5 {
            display: grid;
            grid-template-columns: 90px 70px 80px 60px 80px;
            gap: 12px;
            align-items: end;
        }

        /* 1x2 ê·¸ë¦¬ë“œ (ì™¸í•¨) - ì„¤ì¹˜ ì œê±° í›„ ì¡°ì • */
        .grid-1x2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            align-items: end;
        }

        /* ì™¸í•¨ ì „ìš© ì„ íƒì°½ ìŠ¤íƒ€ì¼ */
        .grid-1x2 .form-select {
            width: 100% !important;
            min-width: auto !important;
            position: relative !important;
            z-index: auto !important;
        }

        .grid-1x2 .form-select:focus {
            width: 100% !important;
            min-width: auto !important;
            position: relative !important;
            z-index: auto !important;
            box-shadow: none !important;
        }

        /* ì„¹ì…˜ í—¤ë” ë‚´ í† ê¸€ ìŠ¤íƒ€ì¼ */
        .header-toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-toggle {
            display: flex;
            background: #f0f0f0;
            border-radius: 20px;
            padding: 2px;
            border: 1px solid #d1d1d1;
        }

        .header-toggle-option {
            padding: 4px 12px;
            border-radius: 18px;
            background: transparent;
            color: #666;
            border: none;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .header-toggle-option.active {
            background: #0078d4;
            color: white;
        }

        /* ë©”ì¸ ì°¨ë‹¨ê¸° ì„¤ì • ë²„íŠ¼ */
        .breaker-settings-btn {
            padding: 10px 20px;
            background: #0078d4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .breaker-settings-btn:hover {
            background: #106ebe;
        }

        /* íƒ€ì›í˜• í† ê¸€ ë²„íŠ¼ */
        .oval-toggle-container {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .oval-toggle-container.vertical {
            flex-direction: column;
            gap: 6px;
            width: 100px;
        }

        .oval-toggle {
            padding: 8px 16px;
            border: 2px solid #d1d1d1;
            border-radius: 25px;
            background: white;
            color: #666;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
            min-width: 80px;
            text-align: center;
        }

        .oval-toggle.active {
            background: #0078d4;
            border-color: #0078d4;
            color: white;
        }

        .oval-toggle.elb.active {
            background: #d13438;
            border-color: #d13438;
            color: white;
        }

        /* ë©”ì¸ ì°¨ë‹¨ê¸° ë ˆì´ì•„ì›ƒ */
        .main-breaker-layout {
            display: flex;
            gap: 20px;
            align-items: start;
            position: relative;
        }

        .main-breaker-layout .form-row {
            margin-bottom: 8px;
            flex-shrink: 0;
            width: auto;
            min-width: 80px;
        }

        .main-select {
            width: 80px !important;
            min-width: 80px !important;
            max-width: 80px !important;
            position: relative !important;
            z-index: auto !important;
        }

        .main-select:focus {
            width: 80px !important;
            min-width: 80px !important;
            max-width: 80px !important;
            position: relative !important;
            z-index: auto !important;
            background: white;
            box-shadow: none !important;
        }

        .form-label {
            font-size: 13px;
            color: #605e5c;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .form-input, .form-select {
            padding: 8px 12px;
            border: 1px solid #d1d1d1;
            border-radius: 2px;
            font-size: 14px;
            background: white;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #0078d4;
        }

        .form-input-small {
            width: 40px;
            padding: 6px 8px;
            text-align: center;
        }

        /* ë¶„ê¸° ì°¨ë‹¨ê¸° ì „ìš© ì‘ì€ ì…ë ¥ í•„ë“œ */
        .form-input-xs {
            width: 35px;
            padding: 6px 4px;
            text-align: center;
            font-size: 13px;
        }

        /* ë¶„ê¸° ì°¨ë‹¨ê¸° ê· ì¼í•œ í¬ê¸° */
        .branch-uniform {
            width: 60px !important;
            padding: 6px 8px;
            text-align: center;
            font-size: 13px;
        }

        /* ë“œë¡­ë‹¤ìš´ í™•ëŒ€ ìŠ¤íƒ€ì¼ */
        .form-select {
            min-width: 120px;
        }

        .form-select option {
            padding: 8px 12px;
            font-size: 14px;
        }

        /* ê¸°ë³¸ ë¸Œë¼ìš°ì € select ìŠ¤íƒ€ì¼ ìœ ì§€ */

        /* AI ì±„íŒ… ìŠ¤íƒ€ì¼ ì˜ì—­ */
        .chat-style-section {
            display: flex;
            flex-direction: column;
            height: 70vh;
            background: #f9f9f9;
            border: 1px solid #e1dfdd;
            border-radius: 8px;
            margin: 20px;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #e1dfdd;
            background: white;
            border-radius: 8px 8px 0 0;
        }

        .chat-title {
            font-size: 18px;
            font-weight: 600;
            color: #323130;
            margin-bottom: 4px;
        }

        .chat-subtitle {
            font-size: 14px;
            color: #605e5c;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-message {
            display: flex;
            justify-content: flex-start;
        }

        .message-content {
            max-width: 80%;
            padding: 12px 16px;
            background: white;
            border: 1px solid #e1dfdd;
            border-radius: 18px 18px 18px 4px;
            font-size: 14px;
            line-height: 1.4;
            color: #323130;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            animation: messageSlideIn 0.5s ease-out;
        }

        /* ë©”ì‹œì§€ ìŠ¬ë¼ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes messageSlideIn {
            0% {
                transform: translateX(-30px);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ìƒˆ ë©”ì‹œì§€ ê°•ì¡° ì• ë‹ˆë©”ì´ì…˜ */
        .message-content.highlight {
            background: #fff3cd;
            border-color: #ffc107;
            animation: messageHighlight 1.5s ease-out;
        }

        @keyframes messageHighlight {
            0% {
                background: #fff3cd;
                transform: scale(1.02);
            }
            100% {
                background: white;
                transform: scale(1);
            }
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        /* ê²¬ì  ìƒì„± ë²„íŠ¼ ì˜ì—­ */
        .generate-estimate-section {
            padding: 20px;
            text-align: center;
            border-top: 1px solid #e1dfdd;
            background: #f9f9f9;
        }

        .generate-estimate-btn {
            padding: 15px 40px;
            font-size: 16px;
            font-weight: 600;
            background: #0078d4;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .generate-estimate-btn:hover {
            background: #106ebe;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 120, 212, 0.3);
        }

        /* ë“œë¡­ë‹¤ìš´ì´ ì—´ë ¸ì„ ë•Œ ë” í¬ê²Œ ë³´ì´ë„ë¡ (ì™¸í•¨, ë¶„ê¸°ì°¨ë‹¨ê¸°, ë¶€ì†ìì¬ ì œì™¸) */
        .form-select:focus:not(.branch-select):not(.accessories-select):not(.grid-1x2 .form-select):not(.main-select) {
            min-width: 200px;
            z-index: 100;
            position: absolute;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* ê·¸ë¦¬ë“œ ë‚´ ì„ íƒì°½ë“¤ì˜ í™•ì¥ ìŠ¤íƒ€ì¼ (ì™¸í•¨ ì œì™¸) */
        .grid-1x4 .form-select:focus {
            min-width: 150px;
        }

        .grid-1x5 .form-select:focus {
            min-width: 140px;
        }

        /* ë¶„ê¸°ì°¨ë‹¨ê¸° ì „ìš© ìŠ¤íƒ€ì¼ */
        .branch-input-row {
            position: relative;
            z-index: 1;
        }

        .branch-select {
            width: 60px !important;
            min-width: 60px !important;
            position: relative !important;
            z-index: auto !important;
            padding: 6px 4px !important;
            font-size: 13px !important;
            text-align: center !important;
        }

        .branch-select:focus {
            width: 60px !important;
            min-width: 60px !important;
            position: relative !important;
            z-index: auto !important;
            box-shadow: none !important;
        }

        /* ë¶„ê¸°ì°¨ë‹¨ê¸° ë¦¬ìŠ¤íŠ¸ë¥¼ ì²˜ìŒì—” ë¹„ìš°ê¸° */
        .branch-list-empty {
            padding: 20px;
            text-align: center;
            color: #999;
            font-style: italic;
        }

        /* ë¶€ì†ìì¬ ì „ìš© ìŠ¤íƒ€ì¼ */
        .accessories-input-row {
            position: relative;
            z-index: 1;
        }

        .accessories-select {
            width: 100% !important;
            min-width: auto !important;
            position: relative !important;
            z-index: auto !important;
            padding: 6px 4px !important;
            font-size: 13px !important;
            text-align: center !important;
        }

        .accessories-select:focus {
            min-width: auto !important;
            position: relative !important;
            z-index: auto !important;
            box-shadow: none !important;
        }

        .accessories-uniform {
            width: 60px !important;
            padding: 6px 8px;
            text-align: center;
            font-size: 13px;
        }

        /* ë¶€ì†ìì¬ ë¦¬ìŠ¤íŠ¸ */
        .accessories-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e1dfdd;
            border-radius: 4px;
            background: white;
        }

        .accessories-list-empty {
            padding: 20px;
            text-align: center;
            color: #999;
            font-style: italic;
        }

        .accessories-item {
            padding: 8px 12px;
            border-bottom: 1px solid #f3f2f1;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .accessories-item:last-child {
            border-bottom: none;
        }

        .accessories-item:hover {
            background: #f9f9f9;
        }

        /* ë²„íŠ¼ */
        .btn {
            padding: 8px 16px;
            border: 1px solid #d1d1d1;
            border-radius: 2px;
            background: white;
            color: #323130;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-primary {
            background: #0078d4;
            color: white;
            border-color: #0078d4;
        }

        .btn-primary:hover {
            background: #106ebe;
        }

        .btn:hover {
            background: #f3f2f1;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 12px;
        }


        /* ë¶„ê¸° ì°¨ë‹¨ê¸° ë¦¬ìŠ¤íŠ¸ */
        .branch-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e1dfdd;
            border-radius: 4px;
            background: white;
        }

        .branch-item {
            padding: 8px 12px;
            border-bottom: 1px solid #f3f2f1;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .branch-item:last-child {
            border-bottom: none;
        }

        .branch-item:hover {
            background: #f9f9f9;
        }

        /* ê²¬ì  í…Œì´ë¸” */
        .estimate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f9f9f9;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .estimate-title {
            font-size: 16px;
            font-weight: 600;
            color: #323130;
        }

        .estimate-total {
            font-size: 16px;
            font-weight: 600;
            color: #0078d4;
        }

        .estimate-table {
            border: 1px solid #e1dfdd;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e1dfdd;
        }

        th {
            background: #f9f9f9;
            font-weight: 600;
            font-size: 14px;
            color: #323130;
        }

        td {
            font-size: 14px;
            color: #323130;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        /* í•˜ë‹¨ ë²„íŠ¼ë“¤ */
        .bottom-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* AI ì±„íŒ… ë²„íŠ¼ */
        .ai-chat-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: #0078d4;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0, 120, 212, 0.3);
            z-index: 1000;
        }

        .ai-chat-button:hover {
            background: #106ebe;
            transform: scale(1.05);
        }

        /* AI ì±„íŒ… íŒì—… - ì™„ì „ ë…ë¦½ ê°ì²´ë¡œ ìˆ˜ì • */
        .ai-chat-popup {
            position: fixed;
            top: 100px;
            right: 50px;
            width: 400px;
            height: 500px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            display: none;
            flex-direction: column;
            z-index: 999999; /* ìµœê³  z-index */
            resize: both;
            overflow: hidden;
            min-width: 300px;
            min-height: 400px;
            border: 3px solid #0078d4; /* ë” ë‘êº¼ìš´ í…Œë‘ë¦¬ */
            /* í™”ë©´ ë°–ì—ì„œë„ ë³´ì´ë„ë¡ í•˜ëŠ” ì¤‘ìš”í•œ ì„¤ì •ë“¤ */
            will-change: transform;
            contain: none; /* contain ì œê±° */
            isolation: isolate; /* ìƒˆë¡œìš´ ìŠ¤íƒ ì»¨í…ìŠ¤íŠ¸ ìƒì„± */
        }

        /* íŒì—…ì˜ ë°°ê²½ ê°•í™” - í™”ë©´ ë°–ì—ì„œë„ ë³´ì´ë„ë¡ */
        .ai-chat-popup::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: rgba(0, 120, 212, 0.1);
            z-index: -1;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 120, 212, 0.3);
        }

        .ai-chat-header {
            background: #0078d4;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            user-select: none;
            position: relative;
            z-index: 1;
        }

        .ai-chat-title {
            font-weight: 600;
            font-size: 16px;
        }

        .ai-chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
        }

        .ai-chat-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: white;
            position: relative;
            z-index: 1;
        }

        /* AI ì±„íŒ… íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ */
        .ai-chat-file-area {
            border: 2px dashed #d1d1d1;
            border-radius: 4px;
            padding: 15px;
            text-align: center;
            margin-bottom: 15px;
            transition: all 0.3s;
            background: #f9f9f9;
        }

        .ai-chat-file-area:hover,
        .ai-chat-file-area.dragover {
            border-color: #0078d4;
            background: #f0f8ff;
        }

        .ai-file-input {
            display: none;
        }

        .ai-file-list {
            max-height: 120px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .ai-file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 10px;
            background: white;
            border-radius: 4px;
            margin-bottom: 4px;
            font-size: 12px;
            border: 1px solid #e1dfdd;
        }

        .ai-file-remove {
            color: #d13438;
            cursor: pointer;
            font-size: 12px;
        }

        .analyze-btn {
            width: 100%;
            padding: 8px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .analyze-btn:hover {
            background: #218838;
        }

        .ai-message {
            background: #f3f2f1;
            padding: 12px 16px;
            border-radius: 8px;
            max-width: 80%;
        }

        .user-message {
            background: #0078d4;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            max-width: 80%;
            align-self: flex-end;
        }

        .ai-chat-input-container {
            padding: 15px 20px;
            border-top: 1px solid #e1dfdd;
            display: flex;
            gap: 10px;
            background: white;
            position: relative;
            z-index: 1;
        }

        .ai-chat-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d1d1;
            border-radius: 4px;
            resize: none;
            max-height: 100px;
        }

        .ai-send-button {
            padding: 8px 16px;
            background: #0078d4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* ì°¨ë‹¨ê¸° ì„¤ì • íŒì—… */
        .breaker-settings-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 380px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1002;
            overflow: hidden;
        }

        .popup-header {
            background: #f9f9f9;
            padding: 15px 20px;
            border-bottom: 1px solid #e1dfdd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .popup-title {
            font-weight: 600;
            font-size: 16px;
        }

        .popup-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
        }

        .popup-content {
            padding: 25px 20px;
            height: calc(100% - 120px);
            overflow-y: auto;
        }

        .popup-content .form-row {
            margin-bottom: 20px;
        }

        /* íŒì—… ë‚´ë¶€ ì„ íƒì°½ í¬ê¸° ê³ ì • */
        .popup-content .form-select {
            width: 100%;
            min-width: auto;
            position: static !important;
            box-shadow: none !important;
        }

        .popup-content .form-select:focus {
            min-width: auto !important;
            position: static !important;
            box-shadow: none !important;
        }

        .popup-buttons {
            padding: 15px 20px;
            border-top: 1px solid #e1dfdd;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* ì˜¤ë²„ë ˆì´ */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1001;
        }

        /* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ */
        .file-upload-area {
            border: 2px dashed #d1d1d1;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        .file-upload-area:hover {
            border-color: #0078d4;
        }

        .file-upload-area.dragover {
            border-color: #0078d4;
            background: #f9f9f9;
        }

        .file-input {
            display: none;
        }

        .file-list {
            margin-top: 10px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f9f9f9;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        .file-remove {
            color: #d13438;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <div class="logo">
                ğŸ“Š KIS CORE
            </div>
            <a href="#" class="menu-item active">
                <span class="menu-icon">ğŸ”’</span>
                ê²¬ì  ì‹œìŠ¤í…œ
            </a>
            <a href="#" class="menu-item">
                <span class="menu-icon">ğŸ¤–</span>
                AI ë§¤ë‹ˆì €
            </a>
            <a href="#" class="menu-item">
                <span class="menu-icon">ğŸ“Š</span>
                ë¶„ì„ ë„êµ¬
            </a>
            <a href="#" class="menu-item">
                <span class="menu-icon">âš™ï¸</span>
                ì„¤ì •
            </a>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="main-content">
            <!-- íƒ­ ì˜ì—­ -->
            <div class="tab-container">
                <div class="tab active">
                    ë¶„ì „ë°˜ ê²¬ì  1
                    <span class="tab-close">Ã—</span>
                </div>
                <button class="new-tab">+ ìƒˆ íƒ­</button>
            </div>

            <!-- ì»¨í…ì¸  ì˜ì—­ -->
            <div class="content-container">
                <!-- ì¢Œì¸¡ ì…ë ¥ íŒ¨ë„ (í™•ëŒ€ë¨) -->
                <div class="left-panel">

                    <!-- ê³ ê° ì •ë³´ (2x2 ê·¸ë¦¬ë“œ) -->
                    <div class="section">
                        <div class="section-header">
                            ê³ ê° ì •ë³´
                        </div>
                        <div class="section-content">
                            <div class="grid-2x2">
                                <div class="form-row">
                                    <label class="form-label">ì—…ì²´ëª…</label>
                                    <input type="text" class="form-input" placeholder="ì—…ì²´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                                </div>
                                <div class="form-row">
                                    <label class="form-label">ì—°ë½ì²˜</label>
                                    <input type="text" class="form-input" placeholder="ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                                </div>
                                <div class="form-row">
                                    <label class="form-label">ì´ë©”ì¼</label>
                                    <input type="email" class="form-input" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                                </div>
                                <div class="form-row">
                                    <label class="form-label">ì£¼ì†Œ</label>
                                    <input type="text" class="form-input" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ì™¸í•¨ ì •ë³´ (1x2 ê·¸ë¦¬ë“œ) -->
                    <div class="section">
                        <div class="section-header">
                            ì™¸í•¨
                            <div class="header-toggle-container">
                                <div class="header-toggle">
                                    <button class="header-toggle-option active" onclick="toggleEnclosureType(this)">ì˜¥ë‚´</button>
                                    <button class="header-toggle-option" onclick="toggleEnclosureType(this)">ì˜¥ì™¸</button>
                                </div>
                            </div>
                        </div>
                        <div class="section-content">
                            <div class="grid-1x2">
                                <div class="form-row">
                                    <label class="form-label">í•¨ì¢…ë¥˜</label>
                                    <select class="form-select">
                                        <option>ê¸°ì„±í•¨</option>
                                        <option>ì£¼ë¬¸ì œì‘í•¨</option>
                                        <option>ê³„ëŸ‰ê¸°í•¨</option>
                                        <option>CTê³„ëŸ‰ê¸°í•¨</option>
                                        <option>FRP ë°•ìŠ¤</option>
                                        <option>í•˜ì´ë°•ìŠ¤</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label class="form-label">ì¬ì§ˆ</label>
                                    <select class="form-select">
                                        <option>STEEL 1.6T</option>
                                        <option>STEEL 1.0T</option>
                                        <option>STEEL 2.0T</option>
                                        <option>SUS201 1.0T</option>
                                        <option>SUS201 1.2T</option>
                                        <option>SUS201 1.5T</option>
                                        <option>SUS304 1.2T</option>
                                        <option>SUS304 1.5T</option>
                                        <option>SUS304 2.0T</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row" style="margin-top: 12px;">
                                <label class="form-label">ê¸°íƒ€ìš”ì²­</label>
                                <input type="text" class="form-input" placeholder="ê¸°íƒ€ ìš”ì²­ì‚¬í•­">
                            </div>
                        </div>
                    </div>

                    <!-- ë©”ì¸ ì°¨ë‹¨ê¸° (ë””ìì¸ ê°œì„ ) -->
                    <div class="section">
                        <div class="section-header">
                            ë©”ì¸ ì°¨ë‹¨ê¸°
                            <button class="breaker-settings-btn" onclick="openBreakerSettings()">ì°¨ë‹¨ê¸° ì„¤ì •</button>
                        </div>
                        <div class="section-content">
                            <!-- ì„¸ë¡œ ë°°ì¹˜ë¡œ ì»´íŒ©íŠ¸í•˜ê²Œ -->
                            <div class="main-breaker-layout">
                                <!-- ì¢…ë¥˜ ì„ íƒ (íƒ€ì›í˜• í† ê¸€ ë²„íŠ¼) -->
                                <div class="form-row">
                                    <label class="form-label">ì¢…ë¥˜</label>
                                    <div class="oval-toggle-container vertical">
                                        <button class="oval-toggle mccb active" onclick="toggleBreakerType(this, 'mccb')">MCCB</button>
                                        <button class="oval-toggle elb" onclick="toggleBreakerType(this, 'elb')">ELB</button>
                                    </div>
                                </div>

                                <!-- ê·¹ìˆ˜ -->
                                <div class="form-row">
                                    <label class="form-label">ê·¹ìˆ˜</label>
                                    <select class="form-select main-select">
                                        <option>4P</option>
                                        <option>3P</option>
                                        <option>2P</option>
                                    </select>
                                </div>

                                <!-- ìš©ëŸ‰ -->
                                <div class="form-row">
                                    <label class="form-label">ìš©ëŸ‰</label>
                                    <select class="form-select main-select">
                                        <option>15A</option>
                                        <option>20A</option>
                                        <option>30A</option>
                                        <option>40A</option>
                                        <option>50A</option>
                                        <option>60A</option>
                                        <option>75A</option>
                                        <option>100A</option>
                                        <option>125A</option>
                                        <option>150A</option>
                                        <option>175A</option>
                                        <option>200A</option>
                                        <option>225A</option>
                                        <option>250A</option>
                                        <option>300A</option>
                                        <option>350A</option>
                                        <option>400A</option>
                                        <option>500A</option>
                                        <option>600A</option>
                                        <option>700A</option>
                                        <option>800A</option>
                                        <option>1000A</option>
                                        <option>1200A</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ë¶„ê¸° ì°¨ë‹¨ê¸° -->
                    <div class="section">
                        <div class="section-header">
                            ë¶„ê¸° ì°¨ë‹¨ê¸°
                        </div>
                        <div class="section-content">
                            <div class="form-row-horizontal branch-input-row">
                                <div style="width: 60px; position: relative;">
                                    <label class="form-label">ì¢…ë¥˜</label>
                                    <select class="form-select branch-select" id="branchType">
                                        <option value="">ì„ íƒ</option>
                                        <option value="MCCB">MCCB</option>
                                        <option value="ELB">ELB</option>
                                    </select>
                                </div>
                                <div style="width: 60px; position: relative; margin-left: 8px;">
                                    <label class="form-label">ê·¹ìˆ˜</label>
                                    <select class="form-select branch-select" id="branchPoles">
                                        <option value="">ì„ íƒ</option>
                                        <option value="2P">2P</option>
                                        <option value="3P">3P</option>
                                        <option value="4P">4P</option>
                                    </select>
                                </div>
                                <div style="width: 60px; position: relative; margin-left: 8px;">
                                    <label class="form-label">ìš©ëŸ‰</label>
                                    <select class="form-select branch-select" id="branchCapacity">
                                        <option value="">ì„ íƒ</option>
                                        <option value="15A">15A</option>
                                        <option value="20A">20A</option>
                                        <option value="30A">30A</option>
                                        <option value="40A">40A</option>
                                        <option value="50A">50A</option>
                                        <option value="60A">60A</option>
                                        <option value="75A">75A</option>
                                        <option value="100A">100A</option>
                                        <option value="125A">125A</option>
                                        <option value="150A">150A</option>
                                        <option value="175A">175A</option>
                                        <option value="200A">200A</option>
                                        <option value="225A">225A</option>
                                        <option value="250A">250A</option>
                                        <option value="300A">300A</option>
                                        <option value="350A">350A</option>
                                        <option value="400A">400A</option>
                                        <option value="500A">500A</option>
                                        <option value="600A">600A</option>
                                        <option value="700A">700A</option>
                                        <option value="800A">800A</option>
                                        <option value="1000A">1000A</option>
                                        <option value="1200A">1200A</option>
                                    </select>
                                </div>
                                <div style="width: 60px; margin-left: 8px;">
                                    <label class="form-label">ìˆ˜ëŸ‰</label>
                                    <input type="number" class="form-input branch-uniform" id="branchQuantity" value="1" min="1" max="10">
                                </div>
                                <div style="width: 80px; margin-left: 25px;">
                                    <label class="form-label">&nbsp;</label>
                                    <button class="btn btn-primary" onclick="addBranchBreaker()">í™•ì¸</button>
                                </div>
                            </div>

                            <div class="branch-list" id="branchList">
                                <div class="branch-list-empty">
                                    ë¶„ê¸° ì°¨ë‹¨ê¸°ë¥¼ ì¶”ê°€í•˜ë ¤ë©´ ìœ„ì—ì„œ ì„¤ì • í›„ í™•ì¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ë¶€ì†ìì¬ (ë§ˆê·¸ë„¤íŠ¸ ê°„ì†Œí™”) -->
                    <div class="section">
                        <div class="section-header">
                            ë¶€ì†ìì¬
                        </div>
                        <div class="section-content">
                            <!-- ë§ˆê·¸ë„¤íŠ¸ ë¼ì¸ -->
                            <div class="form-row-horizontal accessories-input-row" style="margin-bottom: 15px;">
                                <div style="width: 80px; position: relative;">
                                    <label class="form-label">ë§ˆê·¸ë„¤íŠ¸</label>
                                    <select class="form-select accessories-select" id="magnetModel">
                                        <option value="">ì„ íƒ</option>
                                        <option value="MC-9">MC-9</option>
                                        <option value="MC-12">MC-12</option>
                                        <option value="MC-18">MC-18</option>
                                        <option value="MC-22">MC-22</option>
                                        <option value="MC-32">MC-32</option>
                                        <option value="MC-40">MC-40</option>
                                        <option value="MC-50">MC-50</option>
                                        <option value="MC-65">MC-65</option>
                                        <option value="MC-75">MC-75</option>
                                        <option value="MC-85">MC-85</option>
                                        <option value="MC-100">MC-100</option>
                                        <option value="MC-130">MC-130</option>
                                        <option value="MC-150">MC-150</option>
                                    </select>
                                </div>
                                <div style="width: 60px; position: relative; margin-left: 8px;">
                                    <label class="form-label">íƒ€ì´ë¨¸</label>
                                    <select class="form-select accessories-select" id="magnetTimer">
                                        <option value="">ì„ íƒ</option>
                                        <option value="YES">í¬í•¨</option>
                                        <option value="NO">ì œì™¸</option>
                                    </select>
                                </div>
                                <div style="width: 60px; position: relative; margin-left: 8px;">
                                    <label class="form-label">PBL</label>
                                    <select class="form-select accessories-select" id="magnetPBL">
                                        <option value="">ì„ íƒ</option>
                                        <option value="YES">í¬í•¨</option>
                                        <option value="NO">ì œì™¸</option>
                                    </select>
                                </div>
                                <div style="width: 60px; margin-left: 8px;">
                                    <label class="form-label">ìˆ˜ëŸ‰</label>
                                    <input type="number" class="form-input accessories-uniform" id="magnetQuantity" value="1" min="1" max="10">
                                </div>
                                <div style="width: 80px; margin-left: 25px;">
                                    <label class="form-label">&nbsp;</label>
                                    <button class="btn btn-primary" onclick="addMagnetItem()">í™•ì¸</button>
                                </div>
                            </div>

                            <!-- ê¸°íƒ€ ë¶€ì†ìì¬ ë¼ì¸ -->
                            <div class="form-row-horizontal accessories-input-row">
                                <div style="width: 80px; position: relative;">
                                    <label class="form-label">ë¶€ì†ìì¬</label>
                                    <select class="form-select accessories-select" id="accessoryCategory" onchange="updateAccessoryDetails()">
                                        <option value="">ì„ íƒ</option>
                                        <option value="meter">ê³„ëŸ‰ê¸°</option>
                                        <option value="3ct">3CT</option>
                                        <option value="timer">íƒ€ì´ë¨¸</option>
                                        <option value="eocr">EOCR</option>
                                        <option value="condenser">ì½˜ë´ì„œ</option>
                                        <option value="etc">ê¸°íƒ€</option>
                                    </select>
                                </div>
                                <div style="width: 80px; position: relative; margin-left: 8px;">
                                    <label class="form-label">ì„¸ë¶€ì„ íƒ</label>
                                    <select class="form-select accessories-select" id="accessoryDetail">
                                        <option value="">ì„ íƒ</option>
                                    </select>
                                </div>
                                <div style="width: 60px; position: relative; margin-left: 8px;">
                                    <label class="form-label">ê·œê²©</label>
                                    <select class="form-select accessories-select" id="accessorySpec">
                                        <option value="">ì„ íƒ</option>
                                    </select>
                                </div>
                                <div style="width: 60px; margin-left: 8px;">
                                    <label class="form-label">ìˆ˜ëŸ‰</label>
                                    <input type="number" class="form-input accessories-uniform" id="accessoryQuantity" value="1" min="1" max="10">
                                </div>
                                <div style="width: 80px; margin-left: 25px;">
                                    <label class="form-label">&nbsp;</label>
                                    <button class="btn btn-primary" onclick="addAccessoryItem()">í™•ì¸</button>
                                </div>
                            </div>

                            <!-- ë¶€ì†ìì¬ ë¦¬ìŠ¤íŠ¸ -->
                            <div class="accessories-list" id="accessoriesList" style="margin-top: 15px;">
                                <div class="accessories-list-empty">
                                    ë¶€ì†ìì¬ë¥¼ ì¶”ê°€í•˜ë ¤ë©´ ìœ„ì—ì„œ ì„¤ì • í›„ í™•ì¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                                </div>
                            </div>
                        </div>
                    </div>


                </div>

                <!-- ìš°ì¸¡ ê²°ê³¼ íŒ¨ë„ -->
                <div class="right-panel">
                    <!-- AI ì±„íŒ… ìŠ¤íƒ€ì¼ ì‹¤ì‹œê°„ ì •ë³´ í‘œì‹œ ì˜ì—­ -->
                    <div class="chat-style-section" id="liveInfoSection">
                        <div class="chat-header">
                            <div class="chat-title">ğŸ¤– AI ì–´ì‹œìŠ¤í„´íŠ¸</div>
                            <div class="chat-subtitle">ì…ë ¥í•˜ì‹  ì •ë³´ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•´ë“œë¦´ê²Œìš”</div>
                        </div>
                        <div class="chat-messages" id="chatMessages">
                            <!-- ì´ˆê¸° í™˜ì˜ ë©”ì‹œì§€ -->
                            <div class="chat-message">
                                <div class="message-content">
                                    ì•ˆë…•í•˜ì„¸ìš”! ë°°ì „ë°˜ ê²¬ì  ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ì¢Œì¸¡ì—ì„œ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì‹œë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•´ë“œë¦´ê²Œìš”. ğŸ“‹
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ê²¬ì  ê²°ê³¼ ì˜ì—­ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
                    <div class="estimate-section" id="estimateSection" style="display: none;">


                    <!-- ê²¬ì  ì œëª© ë° í•©ê³„ -->
                    <div class="estimate-header">
                        <div class="estimate-title">ë°°ì „ë°˜ ê²¬ì  | ë©”ì¸ MCCB 4P 100A | ë¶„ê¸° 7ê°œ | ë¶€ì†ìì¬ 0ê°œ</div>
                        <div class="estimate-total">í•©ê³„: 485,000 ì›</div>
                    </div>

                    <!-- ê²¬ì  í…Œì´ë¸” -->
                    <div class="estimate-table">
                        <table>
                            <thead>
                                <tr>
                                    <th class="text-center" style="width: 50px;">No</th>
                                    <th style="width: 200px;">í’ˆëª…</th>
                                    <th style="width: 250px;">ê·œê²©</th>
                                    <th class="text-center" style="width: 60px;">ë‹¨ìœ„</th>
                                    <th class="text-center" style="width: 70px;">ìˆ˜ëŸ‰</th>
                                    <th class="text-right" style="width: 120px;">ë‹¨ê°€</th>
                                    <th class="text-right" style="width: 120px;">ê¸ˆì•¡</th>
                                </tr>
                            </thead>
                            <tbody id="estimateTableBody">
                                <tr>
                                    <td class="text-center">1</td>
                                    <td>ë°°ì „ë°˜í•¨ì²´</td>
                                    <td>STEEL 1.6T ì˜¥ë‚´ìš©</td>
                                    <td class="text-center">EA</td>
                                    <td class="text-center">1</td>
                                    <td class="text-right">150,000ì›</td>
                                    <td class="text-right">150,000ì›</td>
                                </tr>
                                <tr>
                                    <td class="text-center">2</td>
                                    <td>ë©”ì¸ ì°¨ë‹¨ê¸° MCCB</td>
                                    <td>4P 100A</td>
                                    <td class="text-center">EA</td>
                                    <td class="text-center">1</td>
                                    <td class="text-right">80,000ì›</td>
                                    <td class="text-right">80,000ì›</td>
                                </tr>
                                <tr>
                                    <td class="text-center">3</td>
                                    <td>ë¶„ê¸° ì°¨ë‹¨ê¸° MCCB</td>
                                    <td>2P 30A</td>
                                    <td class="text-center">EA</td>
                                    <td class="text-center">2</td>
                                    <td class="text-right">25,000ì›</td>
                                    <td class="text-right">50,000ì›</td>
                                </tr>
                                <tr>
                                    <td class="text-center">4</td>
                                    <td>ë¶„ê¸° ì°¨ë‹¨ê¸° MCCB</td>
                                    <td>2P 50A</td>
                                    <td class="text-center">EA</td>
                                    <td class="text-center">1</td>
                                    <td class="text-right">25,000ì›</td>
                                    <td class="text-right">25,000ì›</td>
                                </tr>
                                <tr>
                                    <td class="text-center">5</td>
                                    <td>ë¶„ê¸° ì°¨ë‹¨ê¸° ELB</td>
                                    <td>2P 20A</td>
                                    <td class="text-center">EA</td>
                                    <td class="text-center">4</td>
                                    <td class="text-right">25,000ì›</td>
                                    <td class="text-right">100,000ì›</td>
                                </tr>
                                <tr>
                                    <td class="text-center">6</td>
                                    <td>ë°°ì„ ìì¬</td>
                                    <td>VCTF 3.5sq x 3C</td>
                                    <td class="text-center">M</td>
                                    <td class="text-center">20</td>
                                    <td class="text-right">2,000ì›</td>
                                    <td class="text-right">40,000ì›</td>
                                </tr>
                                <tr>
                                    <td class="text-center">7</td>
                                    <td>ì¡°ë¦½ê³µì„</td>
                                    <td>ë°°ì „ë°˜ ì¡°ë¦½ ë° ì‹œí—˜</td>
                                    <td class="text-center">ì‹</td>
                                    <td class="text-center">1</td>
                                    <td class="text-right">40,000ì›</td>
                                    <td class="text-right">40,000ì›</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- í•˜ë‹¨ ë²„íŠ¼ -->
                    <div class="bottom-buttons">
                        <button class="btn">ì—‘ì…€ ì €ì¥(íšŒì‚¬ ì–‘ì‹)</button>
                        <button class="btn">CSV ì €ì¥</button>
                        <button class="btn">í™”ë©´ ì§€ìš°ê¸°</button>
                    </div>

                    </div> <!-- estimate-section ë -->

                    <!-- ê²¬ì  ìƒì„± ë²„íŠ¼ (í•­ìƒ í‘œì‹œ) -->
                    <div class="generate-estimate-section">
                        <button class="btn btn-primary generate-estimate-btn" onclick="generateEstimate()">ê²¬ì  ìƒì„±</button>
                    </div>

                </div> <!-- right-panel ë -->
            </div>
        </div>
    </div>

    <!-- AI ì±„íŒ… ë²„íŠ¼ -->
    <button class="ai-chat-button" onclick="toggleAiChat()">ğŸ’¬</button>

    <!-- AI ì±„íŒ… íŒì—… - ì™„ì „ ë…ë¦½ ê°ì²´ -->
    <div class="ai-chat-popup" id="ai-chat-popup">
        <div class="ai-chat-header" id="ai-chat-header">
            <div class="ai-chat-title">AI ì–´ì‹œìŠ¤í„´íŠ¸</div>
            <button class="ai-chat-close" onclick="toggleAiChat()">Ã—</button>
        </div>
        <div class="ai-chat-content">
            <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
            <div class="ai-chat-file-area" onclick="document.getElementById('aiFileInput').click()" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragenter="handleDragEnter(event)" ondragleave="handleDragLeave(event)">
                <p>ğŸ“ ë„ë©´/ìë£Œ íŒŒì¼ ì—…ë¡œë“œ</p>
                <p style="font-size: 11px; color: #666; margin-top: 4px;">
                    ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­ (PDF, JPG, PNG, DWG, ì—‘ì…€)
                </p>
            </div>
            <input type="file" id="aiFileInput" class="ai-file-input" multiple accept=".pdf,.jpg,.jpeg,.png,.dwg,.xls,.xlsx">

            <!-- ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ -->
            <div class="ai-file-list" id="aiFileList"></div>

            <!-- AI ë¶„ì„ ë²„íŠ¼ -->
            <button class="analyze-btn" id="analyzeBtn" onclick="analyzeFilesAI()" style="display: none;">
                ğŸ“Š AI ê²¬ì  ìë™ ìƒì„±
            </button>

            <!-- ì±„íŒ… ë©”ì‹œì§€ë“¤ -->
            <div class="ai-message">
                ì•ˆë…•í•˜ì„¸ìš”! ë„ë©´ì´ë‚˜ ìë£Œë¥¼ ì—…ë¡œë“œí•˜ì‹œë©´ ìë™ìœ¼ë¡œ ê²¬ì ì„ ìƒì„±í•´ë“œë¦½ë‹ˆë‹¤. ê²¬ì  ê´€ë ¨ ê¶ê¸ˆí•œ ê²ƒì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”.
            </div>
        </div>
        <div class="ai-chat-input-container">
            <textarea class="ai-chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." rows="1"></textarea>
            <button class="ai-send-button" onclick="sendMessage()">ì „ì†¡</button>
        </div>
    </div>

    <!-- ì°¨ë‹¨ê¸° ì„¤ì • íŒì—… -->
    <div class="overlay" id="overlay"></div>
    <div class="breaker-settings-popup" id="breaker-settings-popup">
        <div class="popup-header">
            <div class="popup-title">ì°¨ë‹¨ê¸° ì„¤ì •</div>
            <button class="popup-close" onclick="closeBreakerSettings()">Ã—</button>
        </div>
        <div class="popup-content">
            <div class="form-row">
                <label class="form-label">ë¸Œëœë“œ</label>
                <select class="form-select">
                    <option>LSì‚°ì „</option>
                    <option>ìŠˆë‚˜ì´ë”</option>
                    <option>ì§€ë©˜ìŠ¤</option>
                    <option>ë¯¸ì“°ë¹„ì‹œ</option>
                    <option>ABB</option>
                </select>
            </div>
            <div class="form-row">
                <label class="form-label">ê²½ì œí˜•/í‘œì¤€í˜•</label>
                <select class="form-select">
                    <option>í‘œì¤€í˜•</option>
                    <option>ê²½ì œí˜•</option>
                </select>
            </div>
            <div class="form-row">
                <label class="form-label">ë©”ì¸ ìˆ˜ëŸ‰</label>
                <select class="form-select">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                </select>
            </div>
        </div>
        <div class="popup-buttons">
            <button class="btn" onclick="closeBreakerSettings()">ì·¨ì†Œ</button>
            <button class="btn btn-primary" onclick="saveBreakerSettings()">ì ìš©</button>
        </div>
    </div>

    <script>
        // ë“œë˜ê·¸ ê´€ë ¨ ë³€ìˆ˜
        let isDragging = false;
        let startX, startY;

        // AI ì±„íŒ… í† ê¸€
        function toggleAiChat() {
            const popup = document.getElementById('ai-chat-popup');
            popup.style.display = popup.style.display === 'none' || popup.style.display === '' ? 'flex' : 'none';
        }

        // ì™„ì „ ë…ë¦½ëœ ë“œë˜ê·¸ ê¸°ëŠ¥
        document.getElementById('ai-chat-header').addEventListener('mousedown', function(e) {
            isDragging = true;
            const popup = document.getElementById('ai-chat-popup');
            const rect = popup.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;

            // ë“œë˜ê·¸ ì¤‘ ì‹œê°ì  í”¼ë“œë°±
            popup.style.cursor = 'grabbing';
            popup.style.opacity = '0.9';

            document.addEventListener('mousemove', dragMove);
            document.addEventListener('mouseup', dragEnd);

            // ì„ íƒ ë°©ì§€
            e.preventDefault();
        });

        function dragMove(e) {
            if (!isDragging) return;

            const popup = document.getElementById('ai-chat-popup');
            let newX = e.clientX - startX;
            let newY = e.clientY - startY;

            // í™”ë©´ ë°–ìœ¼ë¡œ ì™„ì „íˆ ë‚˜ê°ˆ ìˆ˜ ìˆë„ë¡ ì œí•œ ì—†ìŒ
            // ë‹¨, ìµœì†Œí•œ ì¼ë¶€ëŠ” ë³´ì´ë„ë¡ ê·¹ì†Œí•œ ì œí•œë§Œ ì ìš©
            const minVisible = 50; // ìµœì†Œ 50pxëŠ” í™”ë©´ì— ë³´ì´ë„ë¡

            // ì™¼ìª½ìœ¼ë¡œ ë„ˆë¬´ ë§ì´ ë‚˜ê°€ì§€ ì•Šë„ë¡
            if (newX < -popup.offsetWidth + minVisible) {
                newX = -popup.offsetWidth + minVisible;
            }

            // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë„ˆë¬´ ë§ì´ ë‚˜ê°€ì§€ ì•Šë„ë¡
            if (newX > window.innerWidth - minVisible) {
                newX = window.innerWidth - minVisible;
            }

            // ìœ„ìª½ìœ¼ë¡œ ë„ˆë¬´ ë§ì´ ë‚˜ê°€ì§€ ì•Šë„ë¡
            if (newY < -popup.offsetHeight + minVisible) {
                newY = -popup.offsetHeight + minVisible;
            }

            // ì•„ë˜ìª½ìœ¼ë¡œ ë„ˆë¬´ ë§ì´ ë‚˜ê°€ì§€ ì•Šë„ë¡
            if (newY > window.innerHeight - minVisible) {
                newY = window.innerHeight - minVisible;
            }

            popup.style.left = newX + 'px';
            popup.style.top = newY + 'px';
            popup.style.right = 'auto';
            popup.style.transform = 'none';
        }

        function dragEnd() {
            isDragging = false;
            const popup = document.getElementById('ai-chat-popup');
            popup.style.cursor = 'auto';
            popup.style.opacity = '1';

            document.removeEventListener('mousemove', dragMove);
            document.removeEventListener('mouseup', dragEnd);
        }


        // ì™¸í•¨ ì„¤ì¹˜ íƒ€ì… í† ê¸€
        function toggleEnclosureType(element) {
            // ê°™ì€ ê·¸ë£¹ì˜ ë‹¤ë¥¸ ë²„íŠ¼ë“¤ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            const buttons = element.parentNode.querySelectorAll('.header-toggle-option');
            buttons.forEach(btn => btn.classList.remove('active'));

            // í´ë¦­ëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
            element.classList.add('active');
        }

        // ë©”ì¸ ì°¨ë‹¨ê¸° íƒ€ì… í† ê¸€
        function toggleBreakerType(element, type) {
            // ê°™ì€ ê·¸ë£¹ì˜ ë‹¤ë¥¸ ë²„íŠ¼ë“¤ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            const buttons = element.parentNode.querySelectorAll('.oval-toggle');
            buttons.forEach(btn => btn.classList.remove('active'));

            // í´ë¦­ëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
            element.classList.add('active');
        }

        // ì°¨ë‹¨ê¸° ì„¤ì • íŒì—…
        function openBreakerSettings() {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('breaker-settings-popup').style.display = 'block';
        }

        function closeBreakerSettings() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('breaker-settings-popup').style.display = 'none';
        }

        function saveBreakerSettings() {
            alert('ì°¨ë‹¨ê¸° ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            closeBreakerSettings();
        }

        // ë¶€ì†ìì¬ ì„¸ë¶€ì„ íƒ ì—…ë°ì´íŠ¸
        function updateAccessoryDetails() {
            const category = document.getElementById('accessoryCategory').value;
            const detailSelect = document.getElementById('accessoryDetail');
            const specSelect = document.getElementById('accessorySpec');

            detailSelect.innerHTML = '<option value="">ì„ íƒ</option>';
            specSelect.innerHTML = '<option value="">ì„ íƒ</option>';

            const options = {
                'meter': {
                    details: ['ë‹¨ìƒ', 'ì‚¼ìƒ'],
                    specs: ['ì „ìì‹', 'ê¸°ê³„ì‹']
                },
                '3ct': {
                    details: ['100/5A', '200/5A', '300/5A', '400/5A', '500/5A'],
                    specs: ['ë¶€ìŠ¤ë°”ìš©', 'í™˜CT']
                },
                'timer': {
                    details: ['ì¼ëª°ì¼ì¶œ', 'ì…ë ¥/ì¶œë ¥'],
                    specs: ['20A', '30A', '40A', '50A', '75A', '100A']
                },
                'eocr': {
                    details: ['ì¼ë°˜í˜•', 'ZCTë‚´ì¥í˜•'],
                    specs: ['22', '32', '40', '60']
                },
                'condenser': {
                    details: ['ë‹¨ìƒ', 'ì‚¼ìƒ'],
                    specs: {
                        'ë‹¨ìƒ': [
                            'uf: 10', 'uf: 15', 'uf: 20', 'uf: 30', 'uf: 40', 'uf: 50', 'uf: 75', 'uf: 100', 'uf: 150', 'uf: 175', 'uf: 200', 'uf: 250', 'uf: 300', 'uf: 400', 'uf: 500', 'uf: 1000',
                            'KVA: 10', 'KVA: 15', 'KVA: 20', 'KVA: 25', 'KVA: 30', 'KVA: 40', 'KVA: 50'
                        ],
                        'ì‚¼ìƒ': [
                            'uf: 10', 'uf: 15', 'uf: 20', 'uf: 30', 'uf: 40', 'uf: 50', 'uf: 75', 'uf: 100', 'uf: 200', 'uf: 250', 'uf: 300', 'uf: 400', 'uf: 500',
                            'KVA: 10', 'KVA: 15', 'KVA: 20', 'KVA: 25', 'KVA: 30', 'KVA: 35', 'KVA: 40', 'KVA: 50', 'KVA: 60', 'KVA: 75', 'KVA: 100'
                        ]
                    }
                },
                'etc': {
                    details: ['3êµ¬ì½˜ì„¼íŠ¸', '2êµ¬ì½˜ì„¼íŠ¸', 'ë¶„ì „ë°˜ì†Œí™”ê¸°', 'TR', 'F/S', 'ìˆ˜ìœ„ì„¼ì„œ', 'ë‹¨ìì»¤ë²„', 'ë‹¨ìí”¼ì»¤ë²„', 'ì™¸í•¨ê²€ì¹¨ì°½'],
                    specs: ['í‘œì¤€', 'íŠ¹ìˆ˜']
                }
            };

            if (options[category]) {
                options[category].details.forEach(detail => {
                    const optionElement = document.createElement('option');
                    optionElement.value = detail;
                    optionElement.textContent = detail;
                    detailSelect.appendChild(optionElement);
                });

                // ì½˜ë´ì„œì˜ ê²½ìš° specsê°€ ê°ì²´ì´ë¯€ë¡œ íŠ¹ë³„íˆ ì²˜ë¦¬
                if (category === 'condenser') {
                    // ì„¸ë¶€ì„ íƒ ë³€ê²½ ì´ë²¤íŠ¸ ì¶”ê°€
                    detailSelect.onchange = updateCondenserSpecs;
                } else {
                    // ì¼ë°˜ì ì¸ ê²½ìš°
                    if (Array.isArray(options[category].specs)) {
                        options[category].specs.forEach(spec => {
                            const optionElement = document.createElement('option');
                            optionElement.value = spec;
                            optionElement.textContent = spec;
                            specSelect.appendChild(optionElement);
                        });
                    }
                    // ì„¸ë¶€ì„ íƒ ë³€ê²½ ì´ë²¤íŠ¸ ì œê±°
                    detailSelect.onchange = null;
                }
            }
        }

        // ì½˜ë´ì„œ ê·œê²© ì—…ë°ì´íŠ¸ (ì„¸ë¶€ì„ íƒì— ë”°ë¼)
        function updateCondenserSpecs() {
            const detail = document.getElementById('accessoryDetail').value;
            const specSelect = document.getElementById('accessorySpec');

            specSelect.innerHTML = '<option value="">ì„ íƒ</option>';

            const condenserSpecs = {
                'ë‹¨ìƒ': [
                    'uf: 10', 'uf: 15', 'uf: 20', 'uf: 30', 'uf: 40', 'uf: 50', 'uf: 75', 'uf: 100', 'uf: 150', 'uf: 175', 'uf: 200', 'uf: 250', 'uf: 300', 'uf: 400', 'uf: 500', 'uf: 1000',
                    'KVA: 10', 'KVA: 15', 'KVA: 20', 'KVA: 25', 'KVA: 30', 'KVA: 40', 'KVA: 50'
                ],
                'ì‚¼ìƒ': [
                    'uf: 10', 'uf: 15', 'uf: 20', 'uf: 30', 'uf: 40', 'uf: 50', 'uf: 75', 'uf: 100', 'uf: 200', 'uf: 250', 'uf: 300', 'uf: 400', 'uf: 500',
                    'KVA: 10', 'KVA: 15', 'KVA: 20', 'KVA: 25', 'KVA: 30', 'KVA: 35', 'KVA: 40', 'KVA: 50', 'KVA: 60', 'KVA: 75', 'KVA: 100'
                ]
            };

            if (condenserSpecs[detail]) {
                condenserSpecs[detail].forEach(spec => {
                    const optionElement = document.createElement('option');
                    optionElement.value = spec;
                    optionElement.textContent = spec;
                    specSelect.appendChild(optionElement);
                });
            }
        }

        // ë§ˆê·¸ë„¤íŠ¸ ì•„ì´í…œ ì¶”ê°€
        function addMagnetItem() {
            const model = document.getElementById('magnetModel').value;
            const timer = document.getElementById('magnetTimer').value;
            const pbl = document.getElementById('magnetPBL').value;
            const qty = document.getElementById('magnetQuantity').value;

            if (!model) {
                alert('ë§ˆê·¸ë„¤íŠ¸ ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }

            const accessoriesList = document.getElementById('accessoriesList');

            // ì²˜ìŒ ì¶”ê°€í•  ë•Œ ë¹ˆ ë©”ì‹œì§€ ì œê±°
            const emptyMessage = accessoriesList.querySelector('.accessories-list-empty');
            if (emptyMessage) {
                emptyMessage.remove();
            }

            let specs = model;
            if (timer === 'YES') specs += ' + íƒ€ì´ë¨¸';
            if (pbl === 'YES') specs += ' + PBL';

            // ìƒˆ ë¶€ì†ìì¬ ì•„ì´í…œ ì¶”ê°€
            const accessoryItem = document.createElement('div');
            accessoryItem.className = 'accessories-item';
            accessoryItem.innerHTML = `
                <span>ë§ˆê·¸ë„¤íŠ¸ | ${specs} | ìˆ˜ëŸ‰ ${qty}</span>
                <button class="btn btn-small" onclick="removeAccessoryItem(this)">ì‚­ì œ</button>
            `;
            accessoriesList.appendChild(accessoryItem);

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('magnetModel').value = '';
            document.getElementById('magnetTimer').value = '';
            document.getElementById('magnetPBL').value = '';
            document.getElementById('magnetQuantity').value = '1';
        }

        // ë¶€ì†ìì¬ ì•„ì´í…œ ì¶”ê°€
        function addAccessoryItem() {
            const category = document.getElementById('accessoryCategory').value;
            const detail = document.getElementById('accessoryDetail').value;
            const spec = document.getElementById('accessorySpec').value;
            const qty = document.getElementById('accessoryQuantity').value;

            if (!category || !detail) {
                alert('ë¶€ì†ìì¬ì™€ ì„¸ë¶€ì„ íƒì„ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }

            // ë°°ì—´ì— ì¶”ê°€
            let itemName = category;
            if (detail) itemName += ' - ' + detail;
            if (spec) itemName += ' (' + spec + ')';

            accessories.push({
                category: category,
                detail: detail,
                spec: spec,
                quantity: parseInt(qty),
                fullName: itemName
            });

            const accessoriesList = document.getElementById('accessoriesList');

            // ì²˜ìŒ ì¶”ê°€í•  ë•Œ ë¹ˆ ë©”ì‹œì§€ ì œê±°
            const emptyMessage = accessoriesList.querySelector('.accessories-list-empty');
            if (emptyMessage) {
                emptyMessage.remove();
            }

            // ìƒˆ ë¶€ì†ìì¬ ì•„ì´í…œ ì¶”ê°€
            const accessoryItem = document.createElement('div');
            accessoryItem.className = 'accessories-item';
            accessoryItem.innerHTML = `
                <span>${itemName} | ìˆ˜ëŸ‰ ${qty}</span>
                <button class="btn btn-small" onclick="removeAccessoryItem(this, ${accessories.length - 1})">ì‚­ì œ</button>
            `;
            accessoriesList.appendChild(accessoryItem);

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('accessoryCategory').value = '';
            document.getElementById('accessoryDetail').innerHTML = '<option value="">ì„ íƒ</option>';
            document.getElementById('accessorySpec').innerHTML = '<option value="">ì„ íƒ</option>';
            document.getElementById('accessoryQuantity').value = '1';

            // ë¶€ì†ìì¬ ì¢…í•© ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            generateAccessoriesSummary();
        }

        // ë¶€ì†ìì¬ ì‚­ì œ í•¨ìˆ˜
        function removeAccessoryItem(button, index) {
            const accessoryItem = button.parentElement;
            const accessoriesList = document.getElementById('accessoriesList');

            // ë°°ì—´ì—ì„œ ì œê±°
            if (typeof index !== 'undefined') {
                accessories.splice(index, 1);
            } else {
                // ì¸ë±ìŠ¤ê°€ ì—†ëŠ” ê²½ìš° DOMì—ì„œ ì°¾ê¸°
                const allItems = Array.from(accessoriesList.children);
                const itemIndex = allItems.indexOf(accessoryItem);
                if (itemIndex > -1) {
                    accessories.splice(itemIndex, 1);
                }
            }

            accessoryItem.remove();

            // ëª¨ë“  ì•„ì´í…œì´ ì‚­ì œë˜ë©´ ë¹ˆ ë©”ì‹œì§€ ë‹¤ì‹œ í‘œì‹œ
            if (accessoriesList.children.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'accessories-list-empty';
                emptyMessage.textContent = 'ë¶€ì†ìì¬ë¥¼ ì¶”ê°€í•˜ë ¤ë©´ ìœ„ì—ì„œ ì„¤ì • í›„ í™•ì¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.';
                accessoriesList.appendChild(emptyMessage);
            }

            // ë¶€ì†ìì¬ ì¢…í•© ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ (ë¹ˆ ë°°ì—´ì´ë©´ ë©”ì‹œì§€ ì œê±°)
            if (accessories.length > 0) {
                generateAccessoriesSummary();
            } else {
                // ëª¨ë“  ë¶€ì†ìì¬ê°€ ì‚­ì œë˜ë©´ ì±„íŒ… ë©”ì‹œì§€ë„ ì œê±°
                const existingMessage = document.getElementById('accessories-info');
                if (existingMessage) {
                    existingMessage.remove();
                }
            }
        }

        // ë©”ì‹œì§€ ì „ì†¡
        function sendMessage() {
            const input = document.querySelector('.ai-chat-input');
            const message = input.value.trim();

            if (!message) return;

            const chatContent = document.querySelector('.ai-chat-content');

            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            const userMessage = document.createElement('div');
            userMessage.className = 'user-message';
            userMessage.textContent = message;
            chatContent.appendChild(userMessage);

            input.value = '';

            // AI ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
            setTimeout(() => {
                const aiMessage = document.createElement('div');
                aiMessage.className = 'ai-message';
                aiMessage.textContent = 'ê²¬ì  ê´€ë ¨ ë„ì›€ì„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤. êµ¬ì²´ì ì¸ ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë©´ ì•Œë ¤ì£¼ì„¸ìš”.';
                chatContent.appendChild(aiMessage);

                chatContent.scrollTop = chatContent.scrollHeight;
            }, 1000);

            chatContent.scrollTop = chatContent.scrollHeight;
        }

        // íŒŒì¼ ë¶„ì„
        function analyzeFiles() {
            const fileList = document.getElementById('fileList');
            if (fileList.children.length === 0) {
                alert('ë¶„ì„í•  íŒŒì¼ì„ ë¨¼ì € ì—…ë¡œë“œí•˜ì„¸ìš”.');
                return;
            }

            alert('AIê°€ íŒŒì¼ì„ ë¶„ì„í•˜ì—¬ ìë™ìœ¼ë¡œ ê²¬ì ì„ ìƒì„±í•©ë‹ˆë‹¤.');
        }

        // ì—”í„° í‚¤ë¡œ ë©”ì‹œì§€ ì „ì†¡
        document.querySelector('.ai-chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // AI ì±„íŒ… íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        document.getElementById('aiFileInput').addEventListener('change', function(e) {
            handleFileSelect(e.target.files);
        });

        function handleFileSelect(files) {
            const fileList = document.getElementById('aiFileList');
            const analyzeBtn = document.getElementById('analyzeBtn');

            Array.from(files).forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'ai-file-item';
                fileItem.innerHTML = `
                    <span>ğŸ“„ ${file.name}</span>
                    <span class="ai-file-remove" onclick="this.parentElement.remove(); updateAnalyzeButton();">ì‚­ì œ</span>
                `;
                fileList.appendChild(fileItem);
            });

            updateAnalyzeButton();
        }

        function updateAnalyzeButton() {
            const fileList = document.getElementById('aiFileList');
            const analyzeBtn = document.getElementById('analyzeBtn');

            if (fileList.children.length > 0) {
                analyzeBtn.style.display = 'block';
            } else {
                analyzeBtn.style.display = 'none';
            }
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì²˜ë¦¬
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function handleDragEnter(e) {
            e.preventDefault();
            e.stopPropagation();
            e.target.closest('.ai-chat-file-area').classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            e.target.closest('.ai-chat-file-area').classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            e.target.closest('.ai-chat-file-area').classList.remove('dragover');

            const files = e.dataTransfer.files;
            handleFileSelect(files);
        }

        // AI íŒŒì¼ ë¶„ì„ ë° ìë™ í¼ ì±„ìš°ê¸°
        function analyzeFilesAI() {
            const fileList = document.getElementById('aiFileList');
            if (fileList.children.length === 0) {
                alert('ë¶„ì„í•  íŒŒì¼ì„ ë¨¼ì € ì—…ë¡œë“œí•˜ì„¸ìš”.');
                return;
            }

            // AI ë¶„ì„ ì¤‘ ë©”ì‹œì§€ í‘œì‹œ
            const chatContent = document.querySelector('.ai-chat-content');
            const analysisMessage = document.createElement('div');
            analysisMessage.className = 'ai-message';
            analysisMessage.textContent = 'ğŸ“Š AIê°€ íŒŒì¼ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
            chatContent.appendChild(analysisMessage);

            // ì‹œë®¬ë ˆì´ì…˜: 3ì´ˆ í›„ ìë™ í¼ ì±„ìš°ê¸°
            setTimeout(() => {
                fillFormAutomatically();

                const resultMessage = document.createElement('div');
                resultMessage.className = 'ai-message';
                resultMessage.innerHTML = `
                    âœ… <strong>ë¶„ì„ ì™„ë£Œ!</strong><br>
                    ë„ë©´ì„ ë¶„ì„í•˜ì—¬ ë‹¤ìŒ ì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ì…ë ¥í–ˆìŠµë‹ˆë‹¤:<br>
                    â€¢ ê³ ê°ì •ë³´: ãˆœí•œêµ­ì „ê¸°ê³µì—…<br>
                    â€¢ ì™¸í•¨: ì˜¥ë‚´, ê¸°ì„±í•¨, STEEL 1.6T<br>
                    â€¢ ë©”ì¸ì°¨ë‹¨ê¸°: MCCB 4P 200A<br>
                    â€¢ ë¶„ê¸°ì°¨ë‹¨ê¸°: 7ê°œ (MCCB/ELB í˜¼í•©)<br>
                    â€¢ ë¶€ì†ìì¬: ë§ˆê·¸ë„¤íŠ¸ MG-200A + íƒ€ì´ë¨¸<br><br>
                    ê²¬ì  ìƒì„± ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ìµœì¢… ê²¬ì ì´ ìƒì„±ë©ë‹ˆë‹¤.
                `;
                chatContent.appendChild(resultMessage);
                chatContent.scrollTop = chatContent.scrollHeight;

                // íŒŒì¼ ëª©ë¡ ì •ë¦¬
                fileList.innerHTML = '';
                updateAnalyzeButton();
            }, 3000);
        }

        // ìë™ í¼ ì±„ìš°ê¸° í•¨ìˆ˜
        function fillFormAutomatically() {
            // ê³ ê°ì •ë³´ ìë™ ì…ë ¥
            const customerInputs = document.querySelectorAll('.grid-2x2 .form-input');
            if (customerInputs[0]) customerInputs[0].value = 'ãˆœí•œêµ­ì „ê¸°ê³µì—…';
            if (customerInputs[1]) customerInputs[1].value = '02-1234-5678';
            if (customerInputs[2]) customerInputs[2].value = 'contact@hkelectric.co.kr';
            if (customerInputs[3]) customerInputs[3].value = 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123';

            // ì™¸í•¨ì •ë³´ ìë™ ì„¤ì •
            const enclosureSelects = document.querySelectorAll('.grid-1x4 .form-select');
            if (enclosureSelects[0]) enclosureSelects[0].value = 'ì˜¥ë‚´';
            if (enclosureSelects[1]) enclosureSelects[1].value = 'ê¸°ì„±í•¨';
            if (enclosureSelects[2]) enclosureSelects[2].value = 'STEEL 1.6T';

            // ë©”ì¸ì°¨ë‹¨ê¸° ìë™ ì„¤ì •
            const mainBreakerSelects = document.querySelectorAll('.grid-1x5 .form-select');
            if (mainBreakerSelects[0]) mainBreakerSelects[0].value = 'MCCB';
            if (mainBreakerSelects[1]) mainBreakerSelects[1].value = '4P';
            if (mainBreakerSelects[2]) mainBreakerSelects[2].value = '200A';

            // ë¶„ê¸°ì°¨ë‹¨ê¸° ìë™ ì¶”ê°€ (ì˜ˆì‹œ)
            addBranchBreakerAuto('MCCB', '2P', '30A', 3);
            addBranchBreakerAuto('ELB', '2P', '20A', 4);

            // ë§ˆê·¸ë„¤íŠ¸ ìë™ ì„¤ì • ë° íƒ€ì´ë¨¸ í™œì„±í™”
            const magnetModel = document.getElementById('magnetModel');
            if (magnetModel) magnetModel.value = 'MC-100';


            // ê²¬ì  í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ì‹œë®¬ë ˆì´ì…˜)
            updateEstimateTable();
        }

        // ë¶„ê¸°ì°¨ë‹¨ê¸° ì¶”ê°€ í•¨ìˆ˜
        function addBranchBreaker() {
            const type = document.getElementById('branchType').value;
            const poles = document.getElementById('branchPoles').value;
            const capacity = document.getElementById('branchCapacity').value;
            const quantity = document.getElementById('branchQuantity').value;

            // ëª¨ë“  í•„ë“œê°€ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (!type || !poles || !capacity || !quantity) {
                alert('ëª¨ë“  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë°°ì—´ì— ì¶”ê°€
            branchBreakers.push({
                type: type,
                poles: poles,
                capacity: capacity,
                quantity: parseInt(quantity)
            });

            const branchList = document.getElementById('branchList');

            // ì²˜ìŒ ì¶”ê°€í•  ë•Œ ë¹ˆ ë©”ì‹œì§€ ì œê±°
            const emptyMessage = branchList.querySelector('.branch-list-empty');
            if (emptyMessage) {
                emptyMessage.remove();
            }

            // ìƒˆ ë¶„ê¸° ì°¨ë‹¨ê¸° ì•„ì´í…œ ì¶”ê°€
            const branchItem = document.createElement('div');
            branchItem.className = 'branch-item';
            branchItem.innerHTML = `
                <span>${type} | ${poles} ${capacity} | ìˆ˜ëŸ‰ ${quantity}</span>
                <button class="btn btn-small" onclick="removeBranchItem(this, ${branchBreakers.length - 1})">ì‚­ì œ</button>
            `;
            branchList.appendChild(branchItem);

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('branchType').value = '';
            document.getElementById('branchPoles').value = '';
            document.getElementById('branchCapacity').value = '';
            document.getElementById('branchQuantity').value = '1';

            // ë¶„ê¸° ì°¨ë‹¨ê¸° ì¢…í•© ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            generateBranchBreakerSummary();
        }

        // ë¶„ê¸°ì°¨ë‹¨ê¸° ì‚­ì œ í•¨ìˆ˜
        function removeBranchItem(button, index) {
            const branchItem = button.parentElement;
            const branchList = document.getElementById('branchList');

            // ë°°ì—´ì—ì„œ ì œê±°
            if (typeof index !== 'undefined') {
                branchBreakers.splice(index, 1);
            } else {
                // ì¸ë±ìŠ¤ê°€ ì—†ëŠ” ê²½ìš° DOMì—ì„œ ì°¾ê¸°
                const allItems = Array.from(branchList.children);
                const itemIndex = allItems.indexOf(branchItem);
                if (itemIndex > -1) {
                    branchBreakers.splice(itemIndex, 1);
                }
            }

            branchItem.remove();

            // ëª¨ë“  ì•„ì´í…œì´ ì‚­ì œë˜ë©´ ë¹ˆ ë©”ì‹œì§€ ë‹¤ì‹œ í‘œì‹œ
            if (branchList.children.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'branch-list-empty';
                emptyMessage.textContent = 'ë¶„ê¸° ì°¨ë‹¨ê¸°ë¥¼ ì¶”ê°€í•˜ë ¤ë©´ ìœ„ì—ì„œ ì„¤ì • í›„ í™•ì¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.';
                branchList.appendChild(emptyMessage);
            }

            // ë¶„ê¸° ì°¨ë‹¨ê¸° ì¢…í•© ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ (ë¹ˆ ë°°ì—´ì´ë©´ ë©”ì‹œì§€ ì œê±°)
            if (branchBreakers.length > 0) {
                generateBranchBreakerSummary();
            } else {
                // ëª¨ë“  ë¶„ê¸° ì°¨ë‹¨ê¸°ê°€ ì‚­ì œë˜ë©´ ì±„íŒ… ë©”ì‹œì§€ë„ ì œê±°
                const existingMessage = document.getElementById('branch-breakers-info');
                if (existingMessage) {
                    existingMessage.remove();
                }
            }
        }

        // ë¶„ê¸°ì°¨ë‹¨ê¸° ìë™ ì¶”ê°€ í•¨ìˆ˜ (AI ë¶„ì„ìš©)
        function addBranchBreakerAuto(type, poles, capacity, quantity) {
            const branchList = document.getElementById('branchList');

            // ì²˜ìŒ ì¶”ê°€í•  ë•Œ ë¹ˆ ë©”ì‹œì§€ ì œê±°
            const emptyMessage = branchList.querySelector('.branch-list-empty');
            if (emptyMessage) {
                emptyMessage.remove();
            }

            const branchItem = document.createElement('div');
            branchItem.className = 'branch-item';
            branchItem.innerHTML = `
                <span>${type} | ${poles} ${capacity} | ìˆ˜ëŸ‰ ${quantity}</span>
                <button class="btn btn-small" onclick="removeBranchItem(this)">ì‚­ì œ</button>
            `;
            branchList.appendChild(branchItem);
        }

        // ê²¬ì  í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ì‹œë®¬ë ˆì´ì…˜)
        function updateEstimateTable() {
            const estimateTitle = document.querySelector('.estimate-title');
            const estimateTotal = document.querySelector('.estimate-total');

            if (estimateTitle) {
                estimateTitle.textContent = 'ë°°ì „ë°˜ ê²¬ì  | ë©”ì¸ MCCB 4P 200A | ë¶„ê¸° 7ê°œ | ë¶€ì†ìì¬ 1ê°œ';
            }

            if (estimateTotal) {
                estimateTotal.textContent = 'í•©ê³„: 750,000 ì›';
            }
        }

        // AI ì±„íŒ… ìŠ¤íƒ€ì¼ ë©”ì‹œì§€ ì¶”ê°€/ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function addOrUpdateChatMessage(message, messageId, highlight = true) {
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                // ê¸°ì¡´ ë©”ì‹œì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
                let existingMessage = document.getElementById(messageId);

                if (existingMessage) {
                    // ê¸°ì¡´ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                    const contentDiv = existingMessage.querySelector('.message-content');
                    contentDiv.textContent = message;
                    if (highlight) {
                        contentDiv.classList.add('highlight');
                        setTimeout(() => {
                            contentDiv.classList.remove('highlight');
                        }, 1500);
                    }
                } else {
                    // ìƒˆ ë©”ì‹œì§€ ìƒì„±
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'chat-message';
                    messageDiv.id = messageId;

                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'message-content';
                    if (highlight) {
                        contentDiv.classList.add('highlight');
                        setTimeout(() => {
                            contentDiv.classList.remove('highlight');
                        }, 1500);
                    }

                    contentDiv.textContent = message;
                    messageDiv.appendChild(contentDiv);
                    chatMessages.appendChild(messageDiv);
                }

                // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ ì´ë™
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // ê¸°ì¡´ í•¨ìˆ˜ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€
        function addChatMessage(message, highlight = true) {
            addOrUpdateChatMessage(message, 'msg-' + Date.now(), highlight);
        }

        // ê²¬ì  ìƒì„± í•¨ìˆ˜
        function generateEstimate() {
            const liveInfoSection = document.getElementById('liveInfoSection');
            const estimateSection = document.getElementById('estimateSection');

            // ê²¬ì  ìƒì„± ë©”ì‹œì§€ ì¶”ê°€
            const generateMessages = [
                'ğŸ¯ ë„¤! ëª¨ë“  ì •ë³´ê°€ ì¤€ë¹„ë˜ì—ˆë„¤ìš”. ê²¬ì ì„œë¥¼ ì‘ì„±í•´ë“œë¦´ê²Œìš”! ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”... âœ¨',
                'ğŸ“‹ ì™„ë²½í•œ ì‚¬ì–‘ì´ì—ìš”! ì§€ê¸ˆ ê²¬ì ì„ ê³„ì‚°í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê³§ ê²°ê³¼ë¥¼ ë³´ì—¬ë“œë¦´ê²Œìš”! ğŸ’«',
                'âš¡ ì¢‹ì•„ìš”! ì…ë ¥í•´ì£¼ì‹  ëª¨ë“  ì •ë³´ë¡œ ê²¬ì ì„œë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”! ğŸš€'
            ];
            addChatMessage(generateMessages[Math.floor(Math.random() * generateMessages.length)], false);

            setTimeout(() => {
                // ì‹¤ì‹œê°„ ì •ë³´ ì˜ì—­ ìˆ¨ê¸°ê¸°
                liveInfoSection.style.display = 'none';

                // ê²¬ì  ê²°ê³¼ ì˜ì—­ ë³´ì´ê¸°
                estimateSection.style.display = 'block';

                // ê²¬ì  ë°ì´í„° ì—…ë°ì´íŠ¸
                updateEstimateTable();
            }, 1000);
        }

        // ê³ ê° ì •ë³´ ì¶”ì  ë³€ìˆ˜ë“¤
        let customerInfo = {
            company: '',
            contact: '',
            email: '',
            address: ''
        };

        let enclosureInfo = {
            type: 'ì˜¥ë‚´',
            boxType: '',
            material: '',
            request: ''
        };

        let mainBreakerInfo = {
            type: 'MCCB',
            poles: '',
            capacity: '',
            brand: ''
        };

        // ë¶„ê¸° ì°¨ë‹¨ê¸° ë°°ì—´
        let branchBreakers = [];

        // ë¶€ì†ìì¬ ë°°ì—´
        let accessories = [];

        // ì¢…í•© ì •ë³´ í‘œì‹œ ì—¬ë¶€ ì¶”ì 
        let completeSummaryShown = false;

        // ê³ ê° ì •ë³´ ì¢…í•© ë©”ì‹œì§€ ìƒì„± (í•„ìˆ˜ í•­ëª©ì´ ëª¨ë‘ ì™„ë£Œëœ ê²½ìš°ì—ë§Œ)
        function generateCustomerSummary() {
            // í•„ìˆ˜ í•­ëª©: ì—…ì²´ëª…, ì—°ë½ì²˜, ì´ë©”ì¼
            if (customerInfo.company && customerInfo.contact && customerInfo.email) {
                let parts = [];
                parts.push(`ì—…ì²´ëª…ì€ ${customerInfo.company}`);
                parts.push(`ì—°ë½ì²˜ëŠ” ${customerInfo.contact}`);
                parts.push(`ì´ë©”ì¼ì€ ${customerInfo.email}`);
                if (customerInfo.address) parts.push(`ì£¼ì†ŒëŠ” ${customerInfo.address}`);

                const messages = [
                    `ë„¤, ê³ ê°ì •ë³´ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤! ${parts.join('ì´ê³  ')}ì…ë‹ˆë‹¤. ğŸ˜Š`,
                    `ê³ ê°ì •ë³´ê°€ ì˜ ì…ë ¥ë˜ì—ˆë„¤ìš”! ${parts.join(', ')}ë¡œ í™•ì¸ë©ë‹ˆë‹¤. ğŸ‘`,
                    `ê°ì‚¬í•©ë‹ˆë‹¤! ê³ ê°ì •ë³´ëŠ” ${parts.join(', ')}ìœ¼ë¡œ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. âœ¨`
                ];
                const message = messages[Math.floor(Math.random() * messages.length)];
                addOrUpdateChatMessage(message, 'customer-info');
                return true;
            }
            return false;
        }

        // ì™¸í•¨ ì •ë³´ ì¢…í•© ë©”ì‹œì§€ ìƒì„±
        function generateEnclosureSummary() {
            // ëª¨ë“  í•„ìˆ˜ ì •ë³´ê°€ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸ (í•¨ì¢…ë¥˜, ì¬ì§ˆ)
            if (enclosureInfo.boxType && enclosureInfo.material) {
                // ëª¨ë¸ëª… ê²°ì • ë¡œì§
                let modelName = '';

                if (enclosureInfo.type === 'ì˜¥ë‚´' && enclosureInfo.boxType === 'ê¸°ì„±í•¨' && enclosureInfo.material === 'STEEL 1.6T') {
                    modelName = 'HDS';
                } else if (enclosureInfo.type === 'ì˜¥ì™¸' && enclosureInfo.boxType === 'ê¸°ì„±í•¨' && enclosureInfo.material === 'STEEL 1.6T') {
                    modelName = 'HDO';
                } else if (enclosureInfo.type === 'ì˜¥ë‚´' && enclosureInfo.boxType === 'ì£¼ë¬¸ì œì‘í•¨' && enclosureInfo.material === 'STEEL 1.6T') {
                    modelName = 'CDS';
                } else if (enclosureInfo.type === 'ì˜¥ì™¸' && enclosureInfo.boxType === 'ì£¼ë¬¸ì œì‘í•¨' && enclosureInfo.material === 'STEEL 1.6T') {
                    modelName = 'CDO';
                } else if (enclosureInfo.boxType === 'ê³„ëŸ‰ê¸°í•¨') {
                    modelName = 'MDS';
                } else if (enclosureInfo.boxType === 'CTê³„ëŸ‰ê¸°í•¨') {
                    modelName = 'CTDS';
                } else if (enclosureInfo.boxType === 'FRP ë°•ìŠ¤') {
                    modelName = 'FRP-100';
                } else if (enclosureInfo.boxType === 'í•˜ì´ë°•ìŠ¤') {
                    modelName = 'HB-200';
                } else {
                    // ê¸°ë³¸ ëª¨ë¸ëª…
                    modelName = 'STD-100';
                }

                const installType = enclosureInfo.type === 'ì˜¥ë‚´' ? 'ì˜¥ë‚´ë…¸ì¶œ' : 'ì˜¥ì™¸ì„¤ì¹˜';

                const messages = [
                    `ì™¸í•¨ì€ ${enclosureInfo.boxType}ì— ${installType} ${enclosureInfo.material}ë„¤ìš”. ëª¨ë¸ëª…ì€ ${modelName}ì…ë‹ˆë‹¤! ğŸ‘Œ`,
                    `ë„¤, ì™¸í•¨ì€ ${enclosureInfo.boxType} ${installType} ${enclosureInfo.material}ë¡œ í™•ì¸ë©ë‹ˆë‹¤. í•´ë‹¹ ëª¨ë¸ì€ ${modelName}ì´ì—ìš”! ğŸ—ï¸`,
                    `ì¢‹ì•„ìš”! ì™¸í•¨ì€ ${enclosureInfo.boxType}ì˜ ${installType} ${enclosureInfo.material} ì„ íƒí•˜ì…¨êµ°ìš”. ëª¨ë¸ëª… ${modelName}ìœ¼ë¡œ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤! âœ…`
                ];
                const message = messages[Math.floor(Math.random() * messages.length)];
                addOrUpdateChatMessage(message, 'enclosure-info');
                return true;
            }
        }

        // ë©”ì¸ ì°¨ë‹¨ê¸° ì •ë³´ ì¢…í•© ë©”ì‹œì§€ ìƒì„±
        function generateMainBreakerSummary() {
            // ë©”ì¸ ì°¨ë‹¨ê¸°ì˜ í•„ìˆ˜ ì •ë³´ê°€ ëª¨ë‘ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸ (ì¢…ë¥˜, ê·¹ìˆ˜, ìš©ëŸ‰)
            if (mainBreakerInfo.type && mainBreakerInfo.poles && mainBreakerInfo.capacity) {
                // ëª¨ë¸ëª… ê²°ì • ë¡œì§
                let modelName = '';

                if (mainBreakerInfo.type === 'MCCB') {
                    if (mainBreakerInfo.capacity.includes('100A') || mainBreakerInfo.capacity.includes('125A')) {
                        modelName = 'BW100';
                    } else if (mainBreakerInfo.capacity.includes('150A') || mainBreakerInfo.capacity.includes('175A')) {
                        modelName = 'BW150';
                    } else if (mainBreakerInfo.capacity.includes('200A') || mainBreakerInfo.capacity.includes('225A')) {
                        modelName = 'BW200';
                    } else if (mainBreakerInfo.capacity.includes('250A') || mainBreakerInfo.capacity.includes('300A')) {
                        modelName = 'BW250';
                    } else {
                        modelName = 'BW-STD';
                    }
                } else if (mainBreakerInfo.type === 'ELB') {
                    if (mainBreakerInfo.capacity.includes('30A') || mainBreakerInfo.capacity.includes('40A') || mainBreakerInfo.capacity.includes('50A')) {
                        modelName = 'BE50';
                    } else if (mainBreakerInfo.capacity.includes('60A') || mainBreakerInfo.capacity.includes('75A')) {
                        modelName = 'BE75';
                    } else if (mainBreakerInfo.capacity.includes('100A')) {
                        modelName = 'BE100';
                    } else {
                        modelName = 'BE-STD';
                    }
                }

                let brandText = mainBreakerInfo.brand ? ` ${mainBreakerInfo.brand} ë¸Œëœë“œ` : '';

                const messages = [
                    `LSì‚°ì „ í‘œì¤€í˜•ìœ¼ë¡œ ${mainBreakerInfo.type} ${mainBreakerInfo.poles} ${mainBreakerInfo.capacity}ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤. âš¡`,
                    `LSì‚°ì „ í‘œì¤€í˜• ${mainBreakerInfo.type} ${mainBreakerInfo.poles} ${mainBreakerInfo.capacity} ì„ íƒí•˜ì…¨ë„¤ìš”. ğŸ”Œ`,
                    `ë„¤, LSì‚°ì „ í‘œì¤€í˜• ${mainBreakerInfo.type} ${mainBreakerInfo.poles} ${mainBreakerInfo.capacity}ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤. ğŸ‘`
                ];
                const message = messages[Math.floor(Math.random() * messages.length)];
                addOrUpdateChatMessage(message, 'main-breaker-info');
                return true;
            }
            return false;
        }

        // ë¶„ê¸° ì°¨ë‹¨ê¸° ì¢…í•© ë©”ì‹œì§€ ìƒì„±
        function generateBranchBreakerSummary() {
            if (branchBreakers.length > 0) {
                let branchDetails = branchBreakers.map(branch =>
                    `${branch.type} ${branch.poles} ${branch.capacity} ${branch.quantity}ê°œ`
                ).join(', ');

                const messages = [
                    `ë¶„ê¸° ì°¨ë‹¨ê¸°ëŠ” ${branchDetails}ë¡œ êµ¬ì„±í•˜ì…¨ë„¤ìš”! ğŸ’¡`,
                    `ë„¤, ë¶„ê¸° ì°¨ë‹¨ê¸° ${branchDetails} ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤. âš¡`,
                    `ì¢‹ì•„ìš”! ë¶„ê¸° ì°¨ë‹¨ê¸°ëŠ” ${branchDetails}ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤. ğŸ”Œ`
                ];
                const message = messages[Math.floor(Math.random() * messages.length)];
                addOrUpdateChatMessage(message, 'branch-breakers-info');
                return true;
            }
            return false;
        }

        // ë¶€ì†ìì¬ ì¢…í•© ë©”ì‹œì§€ ìƒì„±
        function generateAccessoriesSummary() {
            if (accessories.length > 0) {
                let accessoryDetails = accessories.map(acc =>
                    `${acc.fullName} ${acc.quantity}ê°œ`
                ).join(', ');

                const messages = [
                    `ë¶€ì†ìì¬ëŠ” ${accessoryDetails}ë¡œ êµ¬ì„±í•˜ì…¨ë„¤ìš”! ğŸ”§`,
                    `ë„¤, ë¶€ì†ìì¬ ${accessoryDetails} ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤. ğŸ› ï¸`,
                    `ì¢‹ì•„ìš”! ë¶€ì†ìì¬ëŠ” ${accessoryDetails}ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤. âš™ï¸`
                ];
                const message = messages[Math.floor(Math.random() * messages.length)];
                addOrUpdateChatMessage(message, 'accessories-info');
                return true;
            }
            return false;
        }

        // ê³ ê° ì •ë³´ ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        function setupLiveUpdateListeners() {
            // ê³ ê° ì •ë³´ í•„ë“œë“¤
            const companyInput = document.querySelector('input[placeholder="ì—…ì²´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"]');
            const contactInput = document.querySelector('input[placeholder="ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”"]');
            const emailInput = document.querySelector('input[placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”"]');
            const addressInput = document.querySelector('input[placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”"]');

            let customerTimeout;

            function updateCustomerInfo() {
                clearTimeout(customerTimeout);
                customerTimeout = setTimeout(() => {
                    generateCustomerSummary(); // ì´ì œ ë‚´ë¶€ì—ì„œ ì²´í¬í•˜ì—¬ ë©”ì‹œì§€ í‘œì‹œ
                    checkAndShowCompleteSummary();
                }, 1000);
            }

            if (companyInput) {
                companyInput.addEventListener('input', function() {
                    customerInfo.company = this.value.trim();
                    updateCustomerInfo();
                });
            }

            if (contactInput) {
                contactInput.addEventListener('input', function() {
                    customerInfo.contact = this.value.trim();
                    updateCustomerInfo();
                });
            }

            if (emailInput) {
                emailInput.addEventListener('input', function() {
                    customerInfo.email = this.value.trim();
                    updateCustomerInfo();
                });
            }

            if (addressInput) {
                addressInput.addEventListener('input', function() {
                    customerInfo.address = this.value.trim();
                    updateCustomerInfo();
                });
            }

            // ì™¸í•¨ ì •ë³´ í•„ë“œë“¤
            const enclosureSelects = document.querySelectorAll('.grid-1x4 .form-select');
            let enclosureTimeout;

            function updateEnclosureInfo() {
                clearTimeout(enclosureTimeout);
                enclosureTimeout = setTimeout(() => {
                    generateEnclosureSummary(); // ì´ì œ ë‚´ë¶€ì—ì„œ ì²´í¬í•˜ì—¬ ë©”ì‹œì§€ í‘œì‹œ
                    checkAndShowCompleteSummary();
                }, 500);
            }

            function checkAndShowCompleteSummary() {
                // ëª¨ë“  ì£¼ìš” í•­ëª©ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
                const isCustomerComplete = customerInfo.company && customerInfo.contact && customerInfo.email;
                const isEnclosureComplete = enclosureInfo.boxType && enclosureInfo.material;
                const isMainBreakerComplete = mainBreakerInfo.type && mainBreakerInfo.poles && mainBreakerInfo.capacity;

                // ëª¨ë“  ì£¼ìš” í•­ëª©ì´ ì™„ë£Œë˜ê³  ì•„ì§ ì¢…í•© ì •ë³´ë¥¼ í‘œì‹œí•˜ì§€ ì•Šì•˜ìœ¼ë©´ í‘œì‹œ
                if (isCustomerComplete && isEnclosureComplete && isMainBreakerComplete && !completeSummaryShown) {
                    completeSummaryShown = true; // ì¤‘ë³µ í‘œì‹œ ë°©ì§€
                    setTimeout(() => {
                        const installType = enclosureInfo.type === 'ì˜¥ë‚´' ? 'ì˜¥ë‚´ë…¸ì¶œ' : 'ì˜¥ì™¸ì„¤ì¹˜';
                        let enclosureModel = '';

                        if (enclosureInfo.type === 'ì˜¥ë‚´' && enclosureInfo.boxType === 'ê¸°ì„±í•¨' && enclosureInfo.material === 'STEEL 1.6T') {
                            enclosureModel = 'HDS';
                        } else if (enclosureInfo.type === 'ì˜¥ì™¸' && enclosureInfo.boxType === 'ê¸°ì„±í•¨' && enclosureInfo.material === 'STEEL 1.6T') {
                            enclosureModel = 'HDO';
                        } else {
                            enclosureModel = 'STD-100';
                        }

                        let mainBreakerModel = '';
                        if (mainBreakerInfo.type === 'MCCB') {
                            if (mainBreakerInfo.capacity.includes('100A') || mainBreakerInfo.capacity.includes('125A')) {
                                mainBreakerModel = 'BW100';
                            } else if (mainBreakerInfo.capacity.includes('200A')) {
                                mainBreakerModel = 'BW200';
                            } else {
                                mainBreakerModel = 'BW-STD';
                            }
                        } else {
                            mainBreakerModel = 'BE-STD';
                        }

                        const brandText = mainBreakerInfo.brand ? ` ${mainBreakerInfo.brand}` : '';

                        const summaryMessages = [
                            `ğŸ‰ ëª¨ë“  ê¸°ë³¸ ì‚¬ì–‘ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ“‹ ê³ ê°ì‚¬: ${customerInfo.company}\nğŸ“§ ì—°ë½ì²˜: ${customerInfo.contact}, ${customerInfo.email}\nğŸ“¦ ì™¸í•¨: ${enclosureInfo.boxType} ${installType} ${enclosureInfo.material} (${enclosureModel})\nâš¡ ë©”ì¸ì°¨ë‹¨ê¸°: ${mainBreakerInfo.type} ${mainBreakerInfo.poles} ${mainBreakerInfo.capacity}${brandText} (${mainBreakerModel})\n\nì´ì œ ë¶„ê¸°ì°¨ë‹¨ê¸°ì™€ ë¶€ì†ìì¬ë¥¼ ì¶”ê°€í•˜ì‹œë©´ ê²¬ì ì„œë¥¼ ìƒì„±í•´ë“œë¦´ ìˆ˜ ìˆì–´ìš”! ğŸ‘`,

                            `âœ¨ ê¸°ë³¸ êµ¬ì„±ì´ ëª¨ë‘ ì™„ë£Œë˜ì—ˆë„¤ìš”!\n\nâ€¢ ê³ ê°ì •ë³´: ${customerInfo.company} (${customerInfo.contact})\nâ€¢ ì™¸í•¨ì‚¬ì–‘: ${enclosureInfo.boxType} ${installType} ${enclosureInfo.material} â†’ ${enclosureModel}\nâ€¢ ë©”ì¸ì°¨ë‹¨ê¸°: ${mainBreakerInfo.type} ${mainBreakerInfo.poles} ${mainBreakerInfo.capacity}${brandText} â†’ ${mainBreakerModel}\n\nì¶”ê°€ë¡œ ë¶„ê¸°ì°¨ë‹¨ê¸°ë‚˜ ë¶€ì†ìì¬ë¥¼ ì„ íƒí•˜ì‹  í›„ ê²¬ì  ìƒì„± ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”! ğŸš€`,

                            `ğŸ‘ í›Œë¥­í•´ìš”! ì£¼ìš” ì‚¬ì–‘ì´ ëª¨ë‘ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nâ–ªï¸ ì—…ì²´: ${customerInfo.company}\nâ–ªï¸ ì™¸í•¨: ${enclosureInfo.boxType} (${enclosureModel}) - ${installType} ${enclosureInfo.material}\nâ–ªï¸ ë©”ì¸ì°¨ë‹¨ê¸°: ${mainBreakerInfo.type} (${mainBreakerModel}) - ${mainBreakerInfo.poles} ${mainBreakerInfo.capacity}${brandText}\n\nì´ì œ í•„ìš”í•œ ë¶„ê¸°ì°¨ë‹¨ê¸°ì™€ ë¶€ì†ìì¬ë¥¼ ì¶”ê°€í•´ì£¼ì‹œë©´ ì™„ì„±ì´ì—ìš”! ğŸ’ª`
                        ];

                        addOrUpdateChatMessage(summaryMessages[Math.floor(Math.random() * summaryMessages.length)], 'complete-summary');
                    }, 1500); // 1.5ì´ˆ í›„ì— ì¢…í•© ì •ë³´ í‘œì‹œ
                }
            }

            if (enclosureSelects[0]) { // í•¨ì¢…ë¥˜
                enclosureSelects[0].addEventListener('change', function() {
                    enclosureInfo.boxType = this.value;
                    updateEnclosureInfo();
                });
            }

            if (enclosureSelects[1]) { // ì¬ì§ˆ
                enclosureSelects[1].addEventListener('change', function() {
                    enclosureInfo.material = this.value;
                    updateEnclosureInfo();
                });
            }

            // ê¸°íƒ€ìš”ì²­ í•„ë“œ (ì±„íŒ… ë©”ì‹œì§€ëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ, ì¡°ìš©íˆ ì €ì¥ë§Œ)
            const otherRequestInput = document.querySelector('input[placeholder="ê¸°íƒ€ ìš”ì²­ì‚¬í•­"]');
            if (otherRequestInput) {
                otherRequestInput.addEventListener('input', function() {
                    enclosureInfo.request = this.value.trim();
                });
            }

            // ë©”ì¸ ì°¨ë‹¨ê¸° ì •ë³´
            const mainBreakerSelects = document.querySelectorAll('.grid-1x5 .form-select');
            let mainBreakerTimeout;

            function updateMainBreakerInfo() {
                clearTimeout(mainBreakerTimeout);
                mainBreakerTimeout = setTimeout(() => {
                    generateMainBreakerSummary(); // ì´ì œ ë‚´ë¶€ì—ì„œ ì²´í¬í•˜ì—¬ ë©”ì‹œì§€ í‘œì‹œ
                    checkAndShowCompleteSummary();
                }, 500);
            }

            if (mainBreakerSelects[0]) { // ê·¹ìˆ˜
                mainBreakerSelects[0].addEventListener('change', function() {
                    mainBreakerInfo.poles = this.value;
                    updateMainBreakerInfo();
                });
            }

            if (mainBreakerSelects[1]) { // ìš©ëŸ‰
                mainBreakerSelects[1].addEventListener('change', function() {
                    mainBreakerInfo.capacity = this.value;
                    updateMainBreakerInfo();
                });
            }

            // ë©”ì¸ ì°¨ë‹¨ê¸° ë¸Œëœë“œ
            const mainBrandInput = document.querySelector('.grid-1x5 input[placeholder="ë¸Œëœë“œëª…"]');
            if (mainBrandInput) {
                mainBrandInput.addEventListener('input', function() {
                    if (this.value.trim() !== '') {
                        mainBreakerInfo.brand = this.value.trim();
                        updateMainBreakerInfo();
                    }
                });
            }
        }

        // ì™¸í•¨ í† ê¸€ ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸
        function toggleEnclosureType(button) {
            const buttons = button.parentElement.querySelectorAll('.header-toggle-option');
            buttons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            enclosureInfo.type = button.textContent;

            const messages = [
                `ğŸ“¦ ë„¤! ${button.textContent} ì„¤ì¹˜ë¡œ ì„ íƒí•˜ì…¨ë„¤ìš”. í™˜ê²½ì— ë§ëŠ” ì¢‹ì€ ì„ íƒì´ì—ìš”! ğŸ‘`,
                `${button.textContent} ì„¤ì¹˜ ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•˜ì‹œëŠ”êµ°ìš”! ì•Œê² ìŠµë‹ˆë‹¤. ğŸ˜Š`,
                `ì¢‹ì•„ìš”! ${button.textContent} ì„¤ì¹˜ë¡œ ì„¤ì •í•´ë“œë¦´ê²Œìš”. ğŸ—ï¸`
            ];
            addChatMessage(messages[Math.floor(Math.random() * messages.length)]);
        }

        // ë©”ì¸ ì°¨ë‹¨ê¸° í† ê¸€ ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸
        function toggleMainBreakerType(button) {
            const buttons = button.parentElement.querySelectorAll('.oval-toggle');
            buttons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            mainBreakerInfo.type = button.textContent;

            const messages = [
                `âš¡ ${button.textContent}ë¡œ ì„ íƒí•˜ì…¨êµ°ìš”! ì‹ ë¢°ì„± ë†’ì€ ì œí’ˆì´ì—ìš”. ì•ˆì „í•œ ì„ íƒì…ë‹ˆë‹¤! ğŸ”’`,
                `ë©”ì¸ ì°¨ë‹¨ê¸°ë¥¼ ${button.textContent}ë¡œ ì„¤ì •í•˜ì‹œëŠ”êµ°ìš”. ì „ë¬¸ì ì´ì‹œë„¤ìš”! ğŸ‘¨â€ğŸ”§`,
                `${button.textContent} ì°¨ë‹¨ê¸°ë¡œ ì§„í–‰í• ê²Œìš”! í’ˆì§ˆ ì¢‹ì€ ì„ íƒì´ì—ìš”. âš¡`
            ];
            addChatMessage(messages[Math.floor(Math.random() * messages.length)]);
        }

        // í˜ì´ì§€ ë¡œë“œ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            setupLiveUpdateListeners();

            // ë©”ì¸ ì°¨ë‹¨ê¸° í† ê¸€ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ì¶”ê°€
            const toggleButtons = document.querySelectorAll('.oval-toggle');
            toggleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    toggleMainBreakerType(this);
                });
            });
        });
    </script>
</body>
</html>